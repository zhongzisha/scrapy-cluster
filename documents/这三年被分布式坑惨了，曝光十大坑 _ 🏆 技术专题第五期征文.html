<!doctype html>
<html data-n-head-ssr>
  <head >
    <title>这三年被分布式坑惨了，曝光十大坑 | 🏆 技术专题第五期征文</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="google-site-verification" content="cCHsgG9ktuCTgWgYfqCJql8AeR4gAne4DTZqztPoirE"><meta data-n-head="ssr" name="google-site-verification" content="nPvn9R5NJLsZKTv5VKIbn0OmkRcJ4PC6KdDoTX3n5Mw"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="baidu-site-verification" content="qiK2a1kcFc"><meta data-n-head="ssr" name="360-site-verification" content="4c3c7d57d59f0e1a308462fbc7fd7e51"><meta data-n-head="ssr" name="sogou_site_verification" content="c49WUDZczQ"><meta data-n-head="ssr" name="msapplication-config" content="https://b-gold-cdn.xitu.io/favicons/v2/browserconfig.xml"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="掘金,稀土,Vue.js,微信小程序,Kotlin,RxJava,React Native,Wireshark,敏捷开发,Bootstrap,OKHttp,正则表达式,WebGL,Webpack,Docker,MVVM"><meta data-n-head="ssr" vmid="description" name="description" content="掘金是一个帮助开发者成长的社区，是给开发者用的 Hacker News，给设计师用的 Designer News，和给产品经理用的 Medium。掘金的技术文章由稀土上聚集的技术大牛和极客共同编辑为你筛选出最优质的干货，其中包括：Android、iOS、前端、后端等方面的内容。用户每天都可以在这里找到技术世界的头条内容。与此同时，掘金内还有沸点、掘金翻译计划、线下活动、专栏文章等内容。即使你是 GitHub、StackOverflow、开源中国的用户，我们相信你也可以在这里有所收获。"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="分布式"><meta data-n-head="ssr" vmid="description" name="description" content=""><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://b-gold-cdn.xitu.io/favicons/v2/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon-16x16.png"><link data-n-head="ssr" rel="manifest" href="https://b-gold-cdn.xitu.io/favicons/v2/manifest.json"><link data-n-head="ssr" rel="mask-icon" color="#5bbad5" href="https://b-gold-cdn.xitu.io/favicons/v2/safari-pinned-tab.svg"><link data-n-head="ssr" rel="shortcut icon" href="https://b-gold-cdn.xitu.io/favicons/v2/favicon.ico"><link data-n-head="ssr" rel="search" title="掘金" href="https://b-gold-cdn.xitu.io/conf/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/ionicons/2.0.1/css/ionicons.min.css"><link data-n-head="ssr" rel="stylesheet" href="https://b-gold-cdn.xitu.io/asset/fw-icon/1.0.9/iconfont.css"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.f3142b8.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.3b100c6.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.204899d.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/app.88bad42.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.0d655de.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.1c3d5fa.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/17.ec4a0fa.js" as="script"><link rel="preload" href="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.d009df7.js" as="script"><style data-vue-ssr-id="6d4e8b07:0 580fe052:0 19f03031:0 5c3d9f7f:0 bc0d363a:0 00da2bb5:0 0094bb9d:0 69c38404:0 10d680ba:0 291dc925:0 0df5c402:0 6d1bad94:0 0fd89be5:0 451eb286:0 c277c556:0 7192d33a:0">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection:before{content:"\e600"}.icon-xlchatbox:before{content:"\e601"}.markdown-body embed,.markdown-body iframe,.markdown-body img:not(.equation),.markdown-body video{max-width:100%!important;margin:0}.markdown-body li{list-style:disc outside none;list-style:initial}.markdown-body img.lazyload{visibility:hidden}.markdown-body img.inited{background-color:#f8f9fa;background-position:50%;background-repeat:no-repeat;visibility:visible}.markdown-body img.loaded{background-image:none;background-color:transparent}.markdown-body img.error{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/image-error.3338abe.png)}.markdown-body img.equation{margin:0 .1em;max-width:100%!important;vertical-align:middle}.markdown-body img:not(.equation){cursor:zoom-in}.markdown-body blockquote.warning{position:relative;border-left-color:#f75151;margin-left:8px}.markdown-body blockquote.warning:before{position:absolute;top:14px;left:-12px;background:#f75151;border-radius:50%;content:"!";width:20px;height:20px;color:#fff;display:flex;align-items:center;justify-content:center}.markdown-body pre{position:relative}.markdown-body pre>code.hljs[lang]:before{content:attr(lang);position:absolute;right:15px;top:2px;color:hsla(0,0%,54.9%,.8)}.markdown-body pre>code.hljs[lang][lang=bash]:before{content:""}.markdown-body pre>code.copyable .copy-code-btn{position:absolute;top:6px;right:15px;font-size:12px;line-height:1;cursor:pointer;color:hsla(0,0%,54.9%,.8);transition:color .1s}.markdown-body pre>code.copyable .copy-code-btn:hover{color:#8c8c8c}.markdown-body pre>code.copyable.hljs[lang]:before{right:70px}.markdown-body pre pre>code .copy-code-btn{display:none}.markdown-body pre pre>code.hljs[lang]:before{top:2px;right:15px}@media (max-width:720px){.markdown-body pre>code.copyable.hljs[lang]:before{right:1rem}}#nprogress{pointer-events:none}#nprogress .bar{background:#007fff;position:fixed;z-index:1031;top:0;left:0;width:100%;height:2px}#nprogress .peg{display:block;position:absolute;right:0;width:100px;height:100%;box-shadow:0 0 10px #007fff,0 0 5px #007fff;opacity:1;transform:rotate(3deg) translateY(-4px)}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .bar,.nprogress-custom-parent #nprogress .spinner{position:absolute}@-webkit-keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}body{font-size:12px;line-height:normal}a,button,input{margin:initial}img{width:auto;height:auto}#juejin{overflow-x:visible;overflow-x:initial}html{font-size:12px;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;word-break:break-word;text-rendering:optimizeLegibility;color:#333;background-color:#f4f5f5}html.white{background-color:#fff}body{word-break:break-word;overflow-y:scroll}a{text-decoration:none;cursor:pointer;color:#909090}a:hover{color:#007fff}button{list-style:1}button:disabled{cursor:not-allowed}button.disabled,button.disabled:hover{background-color:#d2d2d2;cursor:not-allowed}ul{padding:0;margin:0}li{list-style:none}#juejin-seo-meta{display:none}.container{position:relative;margin:0 auto;width:100%;max-width:960px}.container:after{display:table;content:"";clear:both}.hidden{display:none}.root-view-bg{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:-1}.shadow{box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.align-center{text-align:center}.align-right{text-align:right}.align-middle{vertical-align:middle}.center{margin-left:auto;margin-right:auto}.text-normal{color:#333}.text-muted{color:#666}.text-muted1{color:#909090}.text-muted2{color:#838383}.text-gray{color:#909090}.text-light{color:#d2d2d2}.text-blue{color:#007fff}.text-blue-hover{color:#0371df}.text-green{color:#37c700}.text-green-hover{color:#3cb40e}.text-orange{color:#ff8900}.text-red{color:#e22323}.text-a,.text-link{cursor:pointer;color:#333}@include transition(color $speed-normal);.text-a:active,.text-a:hover,.text-link:active,.text-link:hover{color:#275b8c}.text-link{color:#259}.text-pointer{cursor:pointer}.line-wrap{white-space:pre-wrap;word-break:break-all}.ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.text-bold,b,strong{font-weight:700}.view-nav{position:fixed;top:5rem;width:100%;height:3.833rem;z-index:100;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);transition:all .2s;transform:translateZ(0)}.view-nav,.view-nav:before{left:0;background-color:#fff}.view-nav:before{content:"";position:absolute;right:0;bottom:0;height:200%;z-index:-1}.view-nav.top{transform:translate3d(0,-5rem,0)}.view-nav .nav-list{max-width:960px;height:100%;margin:auto;display:flex;align-items:center;line-height:1}.view-nav .nav-list .nav-item{height:100%;align-items:center;display:flex;flex-shrink:0;font-size:1.16rem;color:#71777c;padding:0 1rem}.view-nav .nav-list .nav-item:first-child{padding:0 1rem 0 0}.view-nav .nav-list .nav-item:last-child{padding:0 0 0 1rem}.view-nav .nav-list .nav-item.active,.view-nav .nav-list .nav-item:hover{color:#007fff}.view-nav .nav-list .nav-item a{color:inherit}.nav-item{position:relative;cursor:pointer}.nav-item>a:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0}@media (max-width:980px){.view-nav .nav-list{width:auto;overflow-x:auto}.view-nav .nav-list .nav-item:first-child,.view-nav .nav-list .nav-item:last-child{padding:0 1.5rem}}.list-header{padding:1.3rem 1rem;border-bottom:1px solid hsla(0,0%,59.2%,.1)}.list-header .list-nav,.list-header .nav-list{display:flex;justify-content:space-between}.list-header .nav-list{align-items:center;line-height:1}.list-header .nav-list .nav-item.active a,.list-header .nav-list .nav-item a:hover{color:#007fff}.list-header .left .nav-item{padding:0 1.2rem;font-size:1.16rem;border-right:1px solid hsla(0,0%,59.2%,.2)}.list-header .left .nav-item:last-child{border:none}.list-header .right .nav-item{font-size:1.16rem;padding:0 .7rem;position:relative}.list-header .right .nav-item:not(:last-child):after{width:2px;height:2px;border-radius:50%;transform:translate(-50%,-50%);content:"";position:absolute;left:100%;top:50%;background-color:#2b445d;transform:translateY(-50%);opacity:.5}@media (max-width:600px){.list-header .right{display:none}}.button,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#007fff;color:#fff;border-radius:2px;border:none;padding:.5rem 1.3rem;outline:none;transition:background-color .3s,color .3s;cursor:pointer}.button:hover,button:hover{background-color:#0371df;color:#fff}i+span{margin-left:.6rem}button+button{margin-left:.8rem}.subscribe-btn{border:1px solid #37c700;background-color:#fff;color:#37c700;margin:1rem auto;font-size:1.1rem}.subscribe-btn:hover{background-color:#fff;color:#3cb40e;border-color:#3cb40e}.subscribe-btn.subscribed{background-color:#37c700;color:#fff}.subscribe-btn.subscribed:hover{background-color:#3cb40e}.radio-group{cursor:pointer;display:flex;align-items:center;font-size:14px}.radio-group .radio-label{margin-left:6px}input[type=radio]{width:16px;height:16px;border:1px solid #bfcbd9;border-radius:50%;background-color:#fff;cursor:pointer;box-sizing:border-box;position:relative;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none}input[type=radio]:after{width:6px;height:6px;border-radius:50%;background-color:#fff;content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);transition:transform .15s cubic-bezier(.71,-.46,.88,.6)}input[type=radio]:checked{border-color:#20a0ff;background:#3a9afc}input[type=radio]:checked:after{transform:translate(-50%,-50%) scale(1)}input[type=radio]:disabled{background-color:#eef1f6;border-color:#d1dbe5;cursor:not-allowed}input[type=radio]:disabled:checked{border-color:#d1dbe5;background-color:#d1dbe5}input[name=registerSmsCode]::-webkit-contacts-auto-fill-button{display:none;visibility:hidden}.editable,input[type=password],input[type=text],input[type=url],textarea{resize:none;outline:none;width:100%;display:block;box-shadow:none;border:1px solid #ddd;border-radius:2px;transition:border .3s;background-color:#fff;box-sizing:border-box}.aside-top-section{background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);border-radius:2px;margin-bottom:1.3rem;font-size:1.16rem;line-height:1.29;color:#333}.aside-top-section .aside-header{padding:1rem 1.3rem;border-bottom:1px solid hsla(0,0%,59.2%,.1);color:#333;font-size:1.16rem}.aside-top-section .aside-list{padding:1rem 1.3rem}.aside-top-section .aside-list .item{margin-bottom:1.5rem}.busy-icon:before{-webkit-animation:busy-ani 1s linear infinite;animation:busy-ani 1s linear infinite}@-webkit-keyframes busy-ani{to{transform:rotate(1turn)}}@keyframes busy-ani{to{transform:rotate(1turn)}}
.request-health-alert[data-v-ded0787a]{position:fixed;left:2rem;bottom:2rem;padding:1rem;max-width:50%;color:#e33;background-color:#f6e3e3;border:1px solid #e99;z-index:10000}@media (max-width:600px){.request-health-alert[data-v-ded0787a]{display:none}}.title[data-v-ded0787a]{margin:0 0 .4em;font-size:1.5em}.content[data-v-ded0787a]{line-height:1.5}.btn[data-v-ded0787a]{color:inherit;text-decoration:underline;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.close[data-v-ded0787a]{position:absolute;top:0;right:0;padding:1rem;cursor:pointer;opacity:.5}.close[data-v-ded0787a]:hover{opacity:1}
.emoji-barrage .full-screen[data-v-68506677]{position:fixed;left:0;top:0;width:100%;height:100%;z-index:1001;overflow:hidden}.emoji-inner-screen[data-v-68506677]{position:absolute;left:0;width:100%;height:100%;transform:translate3d(-100%,-100%,0)}.emoji-inner-screen .template[data-v-68506677]{position:relative;width:100%;height:100%}.emojin-inner-screen__0.animate[data-v-68506677]{-webkit-animation:left-data-v-68506677 6s ease-in;animation:left-data-v-68506677 6s ease-in}.emojin-inner-screen__1.animate[data-v-68506677]{-webkit-animation:6s ease-in normal-data-v-68506677;animation:6s ease-in normal-data-v-68506677}.emojin-inner-screen__2.animate[data-v-68506677]{-webkit-animation:right-data-v-68506677 6s ease-in;animation:right-data-v-68506677 6s ease-in}@-webkit-keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes left-data-v-68506677{0%{transform:translate3d(-50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes normal-data-v-68506677{0%{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,100%,0)}}@-webkit-keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}@keyframes right-data-v-68506677{0%{transform:translate3d(50%,-100%,0)}to{transform:translate3d(0,100%,0)}}
.modal-mask[data-v-06e234c4]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3);z-index:501}.bind-phone-number-form[data-v-06e234c4]{position:fixed;padding:1.83rem 2.08rem;width:26.5rem;max-width:100%;font-size:1.167rem;background-color:#fff;border-radius:3px;box-sizing:border-box;top:50%;left:50%;z-index:502;transform:translate(-50%,-60%);box-shadow:0 2px 3px 0 rgba(0,0,0,.2)}.close-btn[data-v-06e234c4]{float:right;cursor:pointer;opacity:.4}.close-btn[data-v-06e234c4]:hover{opacity:1}.title[data-v-06e234c4]{font-size:1.42rem;color:#000;font-weight:600;margin:0 0 1rem}.hint[data-v-06e234c4]{font-size:1.25rem;line-height:1.6;font-weight:400;color:#000;margin-bottom:2rem}.hint>a[data-v-06e234c4]{color:#007fff}.input-group[data-v-06e234c4]{margin-bottom:1.5rem}.input-box[data-v-06e234c4]{position:relative;margin-bottom:.8rem}.dropdown-box[data-v-06e234c4]{padding:0 10px;border:1px solid #d9d9d9;display:flex;border-radius:2px;justify-content:center;align-items:center}.dropdown-box .input[data-v-06e234c4]{border:none}.dropdown-box.focus[data-v-06e234c4]{border-color:#007fff}.input[data-v-06e234c4]{width:100%;border:1px solid #e9e9e9;border-radius:2px;outline:none;box-sizing:border-box;padding:.67rem .67rem .67rem 4px}.input[data-v-06e234c4]:focus{border-color:#007fff}.number-input[data-v-06e234c4]{width:74%}.btn[data-v-06e234c4]{width:100%;height:2.92rem;color:#fff;background-color:#007fff;border-radius:2px;outline:none;box-sizing:border-box;cursor:pointer}.btn[data-v-06e234c4]:disabled{background-color:#909090;cursor:default}.vcode-box[data-v-06e234c4]{display:flex;justify-content:center;align-items:center}.vcode-box .input[data-v-06e234c4]{width:auto;flex-grow:1;overflow:hidden}.vcode-box .img-vcode[data-v-06e234c4]{border:1px solid #ddd;position:relative;box-sizing:border-box;overflow:hidden;z-index:0;width:160px;color:#333;height:40px;margin-left:15px;flex-shrink:0}.vcode-box .img-vcode img[data-v-06e234c4]{max-height:46px}.vcode-box .img-vcode .hint[data-v-06e234c4]{position:absolute;z-index:-1;top:0;left:0;display:flex;height:100%;width:100%;justify-content:center;align-items:center}.send-vcode-btn[data-v-06e234c4]{position:absolute;top:0;right:0;height:100%;color:#007fff;font-size:1.25rem;line-height:1;background-color:transparent}.send-vcode-btn[data-v-06e234c4]:disabled{color:#909090;cursor:default}.send-vcode-btn[data-v-06e234c4]:hover(:not(:disabled)){opacity:.8}.masker-fade-enter-active[data-v-06e234c4],.masker-fade-leave-active[data-v-06e234c4]{transition:opacity .3s}.masker-fade-enter[data-v-06e234c4],.masker-fade-leave-to[data-v-06e234c4]{opacity:0}.form-fade-enter-active[data-v-06e234c4],.form-fade-leave-active[data-v-06e234c4]{transition:.3s}.form-fade-enter[data-v-06e234c4],.form-fade-leave-to[data-v-06e234c4]{transform:translate(-50%,-52%);opacity:0}
.dropdown-input-container[data-v-4e5eda86]{height:100%;display:flex}.dropdown-input-container input[data-v-4e5eda86]{border:none;outline:none;width:32px;margin:0;padding:0}.dropdown-input-container .dropdown-input-box[data-v-4e5eda86]:before{content:"+"}.dropdown-input-container .arrow[data-v-4e5eda86]{cursor:pointer;transition:all .45s cubic-bezier(.8,.15,.15,.86)}.dropdown-input-container .dropdown-pannel[data-v-4e5eda86]{position:absolute;width:220px;max-height:188px;border-radius:4px;box-shadow:0 2px 5px 0 rgba(0,0,0,.08);border:1px solid #e8e8e8;background-color:#fff;overflow-y:auto;z-index:200;top:40px;left:-2px}.dropdown-input-container li.item[data-v-4e5eda86]{padding:8px 10px;font-size:14px;line-height:20px;justify-content:space-between;display:flex}.dropdown-input-container li.item[data-v-4e5eda86]:hover{cursor:pointer;background-color:#f5f5f5}.dropdown-input-container li.item.selected[data-v-4e5eda86]{color:#007fff}.dropdown-input-container li>span[data-v-4e5eda86]:last-child{color:#999}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-064b8453]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-064b8453]:before{content:"\e600"}.icon-xlchatbox[data-v-064b8453]:before{content:"\e601"}.column-view[data-v-064b8453]{padding:0 0 8rem}.main-area[data-v-064b8453]{position:relative;width:700px;max-width:100%;background-color:#fff;border-radius:2px;box-sizing:border-box}.main-area[data-v-064b8453]:after{display:table;content:"";clear:both}.article-area[data-v-064b8453]{margin-bottom:1.5rem;padding:0 2rem}.article[data-v-064b8453]{margin-bottom:3rem;padding:2rem 0 0}.article-placeholder[data-v-064b8453]{width:100%}.author-info-block[data-v-064b8453]{display:flex;align-items:center;margin-bottom:2rem}.author-info-block .avatar-link[data-v-064b8453]{font-size:0}.author-info-block .avatar[data-v-064b8453]{flex:0 0 auto;margin-right:1rem;width:3.333rem;height:3.333rem;border-radius:50%}.author-info-block .author-info-box[data-v-064b8453]{min-width:0;flex-grow:1;flex:1}.author-info-block .username[data-v-064b8453]{display:inline-block;width:100%;font-size:1.3rem;font-weight:700;color:#333}.author-info-block .meta-box[data-v-064b8453]{font-size:1.1rem;color:#909090}.author-info-block .time[data-v-064b8453]{letter-spacing:1px}.author-info-block .views-count[data-v-064b8453]{margin-left:.5em}.author-info-block .dot[data-v-064b8453]{margin:0 .5em}@media (max-width:600px){.author-info-block .dot[data-v-064b8453]{margin:0 .2em}}@media (max-width:600px){.author-info-block .follow[data-v-064b8453]{margin-top:12px}}.author-info-block .edit-btn[data-v-064b8453]{color:#1264b6;cursor:pointer}.author-info-block .edit-btn[data-v-064b8453]:hover{text-decoration:underline}.article-hero[data-v-064b8453]{margin-bottom:2rem;width:100%}.article-hero[data-v-064b8453]:after{content:"";display:block;padding-top:56.29%;width:100%;pointer-events:none}.article-title[data-v-064b8453]{margin:.67em 0;font-size:2.5rem;font-weight:700;line-height:1.5}@media (max-width:600px){.article-title[data-v-064b8453]{font-size:2rem}}.article-title .audit-tag-wrap[data-v-064b8453]{transform:translateY(-.5em)}.tag-list-box[data-v-064b8453]{margin-bottom:2rem}.tag-list-box .tag-list-title[data-v-064b8453]{margin-bottom:2rem;padding:0 0 0 2rem;font-size:1.25rem;font-weight:600;color:#000;border-left:6px solid #ddd}.tag-list-box .tag-list[data-v-064b8453]{display:flex;flex-wrap:wrap}.tag-list-box .tag-list .item[data-v-064b8453]{display:flex;align-items:center;margin:0 1.25rem 1rem 0;padding:.167rem;background-color:#fff;border:1px solid #e3e3e3;border-radius:2px}.tag-list-box .tag-list .tag-icon[data-v-064b8453]{width:1.75rem;height:1.75rem;border-radius:2px}@media (max-width:600px){.tag-list-box .tag-list .tag-icon[data-v-064b8453]{display:none}}.tag-list-box .tag-list .tag-title[data-v-064b8453]{padding:0 .75rem;font-size:1rem;line-height:1.75rem;color:#919191}.wechat-banner[data-v-064b8453]{margin-bottom:2rem}@media (min-width:960px){.wechat-banner[data-v-064b8453]{display:none}}.book-box[data-v-064b8453]{margin-bottom:2rem}@media (min-width:960px){.book-box[data-v-064b8453]{display:none}}.footer-author-block[data-v-064b8453]{padding:15px 17px;border-radius:2px;background-color:#f4f5f5;margin-bottom:2rem}@media (max-width:600px){.footer-author-block[data-v-064b8453]{padding:15px 1rem}}.article-banner[data-v-064b8453]{margin-bottom:2.5rem;padding:0 0 0 2rem;border-left:6px solid #ddd}.article-banner .banner-title[data-v-064b8453]{font-size:1.3rem;line-height:1.6;color:#007fff}.article-banner .banner-content[data-v-064b8453]{margin-top:.2rem;font-size:1.1rem;line-height:1.4;color:#909090}.comment-box[data-v-064b8453]{padding:0 2rem}.comment-box.extended[data-v-064b8453]{padding-bottom:2rem}@media (max-width:600px){.comment-box[data-v-064b8453]{padding:0}}.comment-box .comment-title[data-v-064b8453]{margin-bottom:1.3rem;font-size:1.3rem;font-weight:500;text-align:center;color:#909090}.comment-box .comment-form[data-v-064b8453]{margin-bottom:1rem}.recommended-entry-list-title[data-v-064b8453]{padding:1.3rem 2rem;font-size:1.25rem;font-weight:600;color:#909090;border-bottom:1px solid rgba(178,186,194,.15)}.sidebar[data-v-064b8453]{position:absolute;top:0;right:0;width:20rem}.article-suspended-panel[data-v-064b8453]{position:fixed;margin-left:-7rem;top:16rem}.action-bar[data-v-064b8453]{position:fixed;z-index:1;bottom:0;width:100%;left:0}@media (max-width:960px){.sidebar[data-v-064b8453]{display:none}.main-area[data-v-064b8453]{width:100%}.article-area[data-v-064b8453]{margin-bottom:0}.open-in-app[data-v-064b8453]{bottom:6rem}}.border[data-v-064b8453]{border-bottom:1px solid rgba(178,186,194,.15)}
.main-header-box[data-v-6a3e47cf]{position:relative;height:5rem}.main-header[data-v-6a3e47cf]{position:fixed;top:0;left:0;right:0;transition:all .2s;transform:translate3d(0,-100%,0)}.main-header.visible[data-v-6a3e47cf]{transform:translateZ(0)}.main-container>.view[data-v-6a3e47cf]{margin-top:1.767rem}.main-container.with-view-nav>.view[data-v-6a3e47cf]{margin-top:4.67rem}.main-container.tight>.view[data-v-6a3e47cf]{margin-top:0}.main-container.tight.with-view-nav>.view[data-v-6a3e47cf]{margin-top:3.833rem}
@font-face{font-family:iconfont;src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358);src:url(https://b-gold-cdn.xitu.io/fonts/iconfont.eot?t=1470110358#iefix) format("embedded-opentype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.woff?t=1470110358) format("woff"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.ttf?t=1470110358) format("truetype"),url(https://b-gold-cdn.xitu.io/fonts/iconfont.svg?t=1470110358#iconfont) format("svg")}.iconfont[data-v-6f082a2c]{font-family:iconfont!important;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-xlcollection[data-v-6f082a2c]:before{content:"\e600"}.icon-xlchatbox[data-v-6f082a2c]:before{content:"\e601"}.logo[data-v-6f082a2c]{min-width:98px;margin-right:2rem}.nav-item a[data-v-6f082a2c]{color:#71777c}.nav-item.active>.icon[data-v-6f082a2c],.nav-item.active>a[data-v-6f082a2c]{color:#007fff}.nav-item.discount[data-v-6f082a2c]:after{content:"";position:absolute;width:35px;height:28px;background:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/half_discount.3daad5d.gif);background-size:35px 28px;right:-14px;top:10px}.nav-menu-item>a[data-v-6f082a2c]{display:block;color:#71777c}.avatar[data-v-6f082a2c]{width:2.5rem;height:2.5rem;position:relative}.avatar[data-v-6f082a2c],.badge[data-v-6f082a2c]{border-radius:50%}.badge[data-v-6f082a2c]{position:absolute;top:10px;right:-5px;width:11px;height:11px;background-color:#2f74e9}.main-header[data-v-6f082a2c]{background:#fff;border-bottom:1px solid #f1f1f1;color:#909090;height:5rem;z-index:250}.main-header .container[data-v-6f082a2c]{max-width:960px;margin:auto}.container[data-v-6f082a2c]{display:flex;align-items:center;height:100%}.main-nav[data-v-6f082a2c]{height:100%;flex:1 0 auto}.main-nav-list[data-v-6f082a2c]{display:flex}.phone-show-menu[data-v-6f082a2c]{cursor:pointer;display:none}.phone-hide[data-v-6f082a2c]{display:flex}.nav-list[data-v-6f082a2c]{justify-content:flex-end;position:relative}.nav-item[data-v-6f082a2c],.nav-list[data-v-6f082a2c]{display:flex;align-items:center;height:100%;margin:0}.nav-item[data-v-6f082a2c]{color:#71777c;padding:0 1.2rem;font-size:1.33rem;justify-content:center;cursor:pointer}.nav-item.activities .tip[data-v-6f082a2c]{z-index:2;cursor:auto;width:17rem;background:#fff;padding:1rem;display:flex;justify-content:flex-start;position:absolute;top:4.5rem;left:-50%;margin-left:-3.7rem;color:#17181a;font-size:15px;border-radius:2px;box-shadow:0 2px 20px 0 rgba(0,0,0,.12)}.nav-item.activities .tip .panfish[data-v-6f082a2c]{height:63px;width:57px;flex:0 0 auto;background-repeat:no-repeat;background-size:contain}.nav-item.activities .tip .content[data-v-6f082a2c]{display:flex;flex-direction:column;padding:.5rem 0 0 .5rem;color:#17181a}.nav-item.activities .tip .content button[data-v-6f082a2c]{padding:0;width:6.41rem;height:2rem;color:#fff;font-size:13px;border-radius:12px;margin-top:.5rem}.nav-item.activities .tip .triangle[data-v-6f082a2c]{display:block;position:absolute;top:0;left:50%;width:1rem;height:1rem;transform:translate(-50%,-50%) rotate(45deg);background:#fff;border-top:1px solid #f4f5f5;border-left:1px solid #f4f5f5}.nav-item.activities .tip .close[data-v-6f082a2c]{cursor:pointer;width:1rem;height:1rem;position:absolute;top:.5rem;right:.5rem;border-radius:50%;background:#fff;transform:rotate(45deg)}.nav-item.activities .tip .close[data-v-6f082a2c]:after,.nav-item.activities .tip .close[data-v-6f082a2c]:before{content:"";width:.8rem;height:2px;display:block;position:absolute;background:#c5c5c5;left:50%;top:50%;transform:translate(-50%,-50%)}.nav-item.activities .tip .close[data-v-6f082a2c]:after{transform:translate(-50%,-50%) rotate(90deg)}.nav-item.activities .tip .close[data-v-6f082a2c]:hover{opacity:.8}.nav-item .login-button[data-v-6f082a2c]{border:1px solid #007fff;background-color:#fff;padding:.3rem 1.6rem;color:#007fff;line-height:1.9rem}.nav-item:hover>a[data-v-6f082a2c]{color:#007fff}.nav-item[data-v-6f082a2c]:last-child{padding-right:0}.nav-item.link-item[data-v-6f082a2c]{padding:0 1.5rem;height:5rem}.nav-item.book.new-year a[data-v-6f082a2c]:after{left:0;top:0;position:absolute;content:"";background-position:50%;background-repeat:no-repeat;background-size:60px auto;width:100%;height:100%}.nav-item.search[data-v-6f082a2c]{flex:1 1 auto;justify-content:flex-end;cursor:auto}.nav-item.add[data-v-6f082a2c]{cursor:default}.nav-item.notification:hover .icon[data-v-6f082a2c]{color:#007fff}.nav-item.menu[data-v-6f082a2c],.nav-item.submit[data-v-6f082a2c]{position:relative}.nav-item.submit[data-v-6f082a2c]{color:#007fff}.nav-item.submit[data-v-6f082a2c]:hover{color:#0371df}.nav-item.submit[data-v-6f082a2c]:after{content:"|";position:absolute;top:20px;left:100%;color:hsla(0,0%,59.2%,.4)}.nav-item.submit .submit-panel[data-v-6f082a2c]{position:absolute;top:101%;left:-123px;width:326px;box-sizing:border-box;padding:2.5rem 2rem;border-radius:2px;color:#909090;font-size:1.1rem;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(178,181,187,.5);cursor:default;z-index:11}.nav-item.submit .submit-panel[data-v-6f082a2c]:before{content:"";position:absolute;top:0;left:50%;width:1rem;height:1rem;border-top:1px solid rgba(178,181,187,.5);border-left:1px solid rgba(178,181,187,.5);background-color:#fff;transform:rotate(45deg) translate(-50%,-50%);transform-origin:0 0}.nav-item.submit .submit-panel .title[data-v-6f082a2c]{font-size:1.4rem;line-height:1;font-weight:700;color:#000;text-align:center;margin-bottom:2rem}.nav-item.submit .submit-panel .benefit-list[data-v-6f082a2c]{margin-left:2rem}.nav-item.submit .submit-panel .item[data-v-6f082a2c]{list-style:disc outside none;list-style:initial;margin-bottom:1rem}.nav-item.submit .submit-panel .link[data-v-6f082a2c]{color:#6cbd45;text-decoration:underline}.nav-item.submit .submit-panel button[data-v-6f082a2c]{display:block;margin:2rem auto 0;background-color:#83c73a;font-size:1.2rem;padding:1rem 4rem}.nav-item.auth[data-v-6f082a2c]{color:#007fff;padding:0}.nav-item.auth span[data-v-6f082a2c]:hover{color:#0371df}.nav-item.auth .login[data-v-6f082a2c]:after{content:"·";margin:0 .4rem}.nav-item .icon[data-v-6f082a2c]{font-size:2rem;color:#71777c}.nav-item .icon[data-v-6f082a2c]:hover{color:#007fff}.submit-fixed-bg[data-v-6f082a2c]{position:fixed;top:0;left:0;right:0;bottom:0;opacity:0;z-index:10}.search-form[data-v-6f082a2c]{border:1px solid hsla(0,0%,59.2%,.2);background-color:rgba(227,231,236,.2);display:flex;align-items:center;justify-content:space-between;border-radius:2px}.search-form.active[data-v-6f082a2c]{background-color:#fff;border:1px solid #007fff}.search-form .search-icon[data-v-6f082a2c]{padding:0 .5rem;cursor:pointer}.search-form .search-input[data-v-6f082a2c]{border:none;width:11rem;padding:.6rem 0 .6rem 1rem;box-shadow:none;outline:none;font-size:1.1rem;color:#666;background-color:transparent}.nav-menu[data-v-6f082a2c]{position:absolute;width:11rem;left:50%;top:100%;transform:translateX(-50%);margin:0;padding:0;list-style:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.nav-menu .nav-menu-item-group[data-v-6f082a2c]{padding:1rem 0}.nav-menu .nav-menu-item[data-v-6f082a2c]{font-size:1.3rem;cursor:pointer}.nav-menu .nav-menu-item[data-v-6f082a2c]:hover{background-color:hsla(0,0%,94.9%,.5)}.nav-menu .nav-menu-item>a[data-v-6f082a2c]{display:flex;align-items:center;padding:.5rem 1rem}.nav-menu .nav-menu-item>a>span[data-v-6f082a2c]{margin-left:0;flex-grow:1}.nav-menu .nav-menu-item>a.link-icon[data-v-6f082a2c]{padding-right:.5rem}.nav-menu .nav-menu-item .collect[data-v-6f082a2c],.nav-menu .nav-menu-item .zan[data-v-6f082a2c]{margin-right:.8rem;width:18.72px;height:18px}.nav-menu .nav-menu-item .icon-2018[data-v-6f082a2c]{width:38px;height:20px;border-radius:1rem;margin-left:2px;background-image:url(https://gold-cdn.xitu.io/asset/2018/2018-icon.png);background-size:102% 100%;background-repeat:no-repeat;box-shadow:3px 3px 6px -3px #999}.nav-menu .nav-menu-item .icon-2018[data-v-6f082a2c]:hover{opacity:.9}.nav-menu .more[data-v-6f082a2c]{position:relative}.nav-menu .more:hover .more-dropdown-list[data-v-6f082a2c]{display:block}.nav-menu .more .more-icon[data-v-6f082a2c]{float:right;color:#b2bac2;font-size:1.2rem;line-height:2rem}.nav-menu.user-dropdown-list[data-v-6f082a2c]{width:13.1rem;right:0;left:auto;transform:translateX(0)}.nav-menu.user-dropdown-list .nav-menu-item-group[data-v-6f082a2c]:not(:last-child){border-bottom:1px solid rgba(0,0,0,.04)}.add-group[data-v-6f082a2c]{display:flex;align-items:center;position:relative;height:2.667rem;cursor:pointer}.add-group.active .more-list[data-v-6f082a2c]{display:block}.add-group .add-btn[data-v-6f082a2c],.add-group .more[data-v-6f082a2c]{height:100%;color:#fff;background-color:#007fff;border-radius:3px}.add-group .add-btn.active[data-v-6f082a2c],.add-group .add-btn[data-v-6f082a2c]:hover,.add-group .more.active[data-v-6f082a2c],.add-group .more[data-v-6f082a2c]:hover{background-color:#0876e4}.add-group .add-btn[data-v-6f082a2c]{padding:0 .9rem;font-size:1.167rem;border-top-right-radius:0;border-bottom-right-radius:0}.add-group .more[data-v-6f082a2c]{flex:0 0 auto;display:flex;align-items:center;justify-content:center;width:1.25rem;border-left:1px solid hsla(0,0%,100%,.1);border-top-left-radius:0;border-bottom-left-radius:0}.add-group .more .more-icon[data-v-6f082a2c]{margin-top:.2rem;font-size:1rem}.add-group .more-list[data-v-6f082a2c]{position:absolute;top:100%;left:0;right:0;padding:.417rem 0;font-size:1.167rem;color:#3b76c5;background-color:#fff;border:1px solid #ebebeb;border-radius:2px;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);display:none;z-index:1}.add-group .more-list .item[data-v-6f082a2c]{padding:0 0 0 .8rem;line-height:1.9}.add-group .more-list .item[data-v-6f082a2c]:hover{background-color:#f9f9f9}.more-dropdown-list[data-v-6f082a2c]{position:absolute;left:auto;top:0;right:102%;transform:translateX(0);display:none}.more-dropdown-list[data-v-6f082a2c]:after{content:"";position:absolute;top:0;left:100%;width:1.3rem;height:4rem}.notification[data-v-6f082a2c]{position:relative}.notification.active .icon[data-v-6f082a2c]{color:#007fff}.notification .count[data-v-6f082a2c]{position:absolute;left:50%;bottom:43%;margin:0;font-size:1rem;line-height:1;text-align:center;background-color:#007fff;border-radius:3rem;word-break:normal;display:inline-block;color:#f1f1f1;transform:scale(.8);font-size:13px;font-weight:500;padding:3px 6px;background:#f03535;border-radius:100px;border:2px solid #fff}.fengwei[data-v-6f082a2c]{display:inline-block;width:1em;height:1em;margin-right:.8rem;font-size:1.2em;vertical-align:middle;color:#b2bac2}.fix-bg[data-v-6f082a2c]{position:fixed;top:0;left:0;bottom:0;right:0;opacity:0}.mobile[data-v-6f082a2c]{display:none}@media (max-width:980px){.logo[data-v-6f082a2c]{margin-right:0;margin-left:.67rem}.container[data-v-6f082a2c]{width:96%}.main-nav-list[data-v-6f082a2c]{display:block;position:absolute;left:0;top:0;background-color:#fff;z-index:1}.phone-show-menu[data-v-6f082a2c]{height:5rem;display:flex;align-items:center;color:#007fff;font-size:1.33rem;justify-content:center;padding:0;width:5.66rem}.phone-show-menu span[data-v-6f082a2c]{margin-right:.6rem}.phone-hide[data-v-6f082a2c]{display:none;background-color:#fff;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border:1px solid rgba(177,180,185,.45);border-radius:4px;font-size:1.2rem}.phone-hide.show[data-v-6f082a2c]{display:block}.nav-item.link-item[data-v-6f082a2c]{height:4rem}.nav-item.add[data-v-6f082a2c],.nav-item.submit[data-v-6f082a2c],.pinTip[data-v-6f082a2c]{display:none}.tip[data-v-6f082a2c]{display:none!important}.nav-menu .nav-menu-item .icon-2018[data-v-6f082a2c]{width:35px;margin-left:0}}@media (max-width:700px){.nav-item.search[data-v-6f082a2c]{display:flex;padding-right:1.2rem}.nav-item .search-form .search-input[data-v-6f082a2c]{width:11rem;padding:.6rem}.nav-item .search-form .search-icon[data-v-6f082a2c]{display:none}.logo[data-v-6f082a2c]{min-width:3.75rem}.logo-img[data-v-6f082a2c]{display:none}.mobile[data-v-6f082a2c]{display:block}.notification[data-v-6f082a2c]{padding:0 .8rem}}@media (max-width:375px){.nav-item .search-form .search-input[data-v-6f082a2c]{width:10rem}}@media (max-width:330px){.nav-item.search[data-v-6f082a2c]{display:none}.nav-item.search .search-form .search-input[data-v-6f082a2c]{width:5rem}}.tip-fade-enter-active[data-v-6f082a2c],.tip-fade-leave-active[data-v-6f082a2c]{transition:.3s}.tip-fade-enter[data-v-6f082a2c],.tip-fade-leave-to[data-v-6f082a2c]{transform:translateY(-10px);opacity:0}
.avatar[data-v-1c418ef0]{display:inline-block;position:relative;background-size:cover;background-color:#eee}.avatar[data-v-1c418ef0],.avatar.xmas[data-v-1c418ef0]:after{background-position:50%;background-repeat:no-repeat}.avatar.xmas[data-v-1c418ef0]:after{content:"";position:absolute;left:25%;bottom:30%;width:90%;height:90%;background-size:contain;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/hats.12a740a.svg);transform:rotate(15deg);transform-origin:bottom right;transition:all .2s}.avatar.xmas[data-v-1c418ef0]:hover:after{transform:rotate(20deg)}
.lazy[data-v-47cc2604]{position:relative}.lazy[data-v-47cc2604]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background-color:inherit;border-radius:inherit}.lazy[data-v-47cc2604]:not(.immediate):before{transition:opacity .2s}.lazy.loaded[data-v-47cc2604]:before{opacity:0;pointer-events:none}
.username[data-v-1b6b7cba]{font-size:1.25rem;font-weight:600;color:#2e3135}.username .name[data-v-1b6b7cba]{display:inline-block;vertical-align:top;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.recommend-author-block .username .name[data-v-1b6b7cba]{max-width:130px}.recommendation-index-view .username .name[data-v-1b6b7cba]{max-width:200px}
.follow-button[data-v-06c7d5b3]{margin:0 0 0 auto;padding:0;width:55px;height:26px;font-size:13px;border:1px solid #6cbd45;color:#6cbd45;background-color:#fff}.follow-button[data-v-06c7d5b3]:hover{opacity:.8}.follow-button.followed[data-v-06c7d5b3]{color:#fff;border-color:#6cbd45;background-color:#6cbd45}
.thumb[data-v-7b344634]{background-position:50%;background-size:cover;background-repeat:no-repeat}
[data-v-78c9b824] .image-viewer{position:fixed;top:0;left:0;right:0;bottom:0;z-index:10000}[data-v-78c9b824] .image-viewer.loading:after{content:"";position:absolute;top:0;right:100%;width:50%;height:.2rem;background-color:#007fff;z-index:1;-webkit-animation:pro-data-v-78c9b824 1s ease-in-out infinite;animation:pro-data-v-78c9b824 1s ease-in-out infinite;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}@keyframes pro-data-v-78c9b824{0%{transform:translateZ(0)}to{transform:translate3d(300%,0,0)}}
.panel-btn[data-v-19356a56]{position:relative;margin-bottom:.75rem;width:3rem;height:3rem;background-color:#fff;background-position:50%;background-repeat:no-repeat;border-radius:50%;box-shadow:0 2px 4px 0 rgba(0,0,0,.04);cursor:pointer}.panel-btn:not(.share-btn).active.with-badge[data-v-19356a56]:after{background-color:#74ca46}.panel-btn.with-badge[data-v-19356a56]:after{content:attr(badge);position:absolute;top:0;left:75%;padding:.1rem .4rem;font-size:1rem;text-align:center;line-height:1;white-space:nowrap;color:#fff;background-color:#b2bac2;border-radius:.7rem;transform-origin:left top;transform:scale(.75)}.panel-btn.like-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE2IDE1Ij4KICAgIDxwYXRoIGZpbGw9IiM2Q0JENDUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTIuODc0IDYuMDQ0VjE1aC0xLjczQy41MTMgMTUgMCAxNC4zODIgMCAxMy42MjRWNy41MjljMC0uNzkuNTM1LTEuNDg1IDEuMTQzLTEuNDg1aDEuNzMxek03LjYwNyAxLjI1QzcuNzIuNTA3IDguMzQ0LS4wMTMgOS4wMyAwYy45OC4wMTkgMS41NjMuODMzIDEuNzY2IDEuMjM1LjM3LjczNS4zOCAxLjk0Ni4xMjYgMi43MjQtLjIzLjcwNC0uNzYxIDEuNjI5LS43NjEgMS42MjloMy45ODJjLjQyIDAgLjgxMS4yMDYgMS4wNzIuNTYzYTEuNSAxLjUgMCAwIDEgLjIzMiAxLjI3MmwtMS44MDEgNi41MTNjLS4xNjQuNjI3LS43MDcgMS4wNjQtMS4zMiAxLjA2NEg0LjVWNS44OThDNi4yOTkgNS41MSA3LjQwNCAyLjU5IDcuNjA3IDEuMjQ5eiIvPgo8L3N2Zz4K)}.panel-btn.like-btn.like-adjust[data-v-19356a56]{background-position:53% 46%}.panel-btn.comment-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDE0IDEzIj4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDB2OS4yM0g4LjgxNUwzLjM3IDEzVjkuMjNIMFYweiIvPgo8L3N2Zz4K)}.panel-btn.comment-btn.comment-adjust[data-v-19356a56]{background-position:50% 55%}.panel-btn.collect-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiM4QTkzQTAiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.collect-btn.active[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNyIgaGVpZ2h0PSIxNyIgdmlld0JveD0iMCAwIDE3IDE3Ij4KICAgIDxwYXRoIGZpbGw9IiNGRkMzNDciIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTkuMzMyIDE0Ljk2OGMtLjQ2LS4yNTUtMS4yMDUtLjI1NS0xLjY2NiAwTDQuMzUgMTYuNzk0Yy0uOTIxLjUwNi0xLjUyMy4wNDQtMS4zNDktMS4wMjdsLjYzNS0zLjg2N2MuMDg4LS41MzctLjE0Mi0xLjI4LS41MTYtMS42NkwuNDM2IDcuNWMtLjc0NS0uNzYtLjUxMS0xLjUwNC41MTYtMS42NmwzLjcwNy0uNTY0Yy41MTQtLjA4IDEuMTE5LS41MzggMS4zNDgtMS4wMjdMNy42NjUuNzMxYy40NjItLjk3NiAxLjIwOC0uOTczIDEuNjY3IDBsMS42NiAzLjUxOWMuMjMuNDg5LjgzMy45NSAxLjM0OSAxLjAyN2wzLjcwOC41NjRjMS4wMjkuMTU2IDEuMjU4LjkwMi41MTUgMS42NmwtMi42ODUgMi43MzljLS4zNzIuMzgtLjYwMyAxLjEyMy0uNTE1IDEuNjZsLjYzNCAzLjg2N2MuMTc2IDEuMDc0LS40MyAxLjUzMy0xLjM0OCAxLjAyN2wtMy4zMTgtMS44MjZ6Ii8+Cjwvc3ZnPgo=)}.panel-btn.weibo-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo.2076a57.svg)}.panel-btn.weibo-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/weibo-hover.9abf502.svg)}.panel-btn.qq-btn[data-v-19356a56]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiNCMkJBQzIiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.qq-btn[data-v-19356a56]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE1IDE2Ij4KICAgIDxwYXRoIGZpbGw9IiM1NUIyRjEiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjQ2OCAxMC4zMTJjLS4wMS0uOTU3LS4zOC0xLjQ3Ni0uODA3LTIuMTUzLS4xOTEtLjI4My0uNDEzLS40NzMtLjYwNS0uNzU1LS4wMy0uMTU0LjAzMy0uMjY4LS4wMTItLjY3MS0uMDQyLS42MDQtLjI2My0uODM4LS4zMS0uOTEyLjAyLS4xNi0uMDQzLTEuNDg1LS41MjMtMi4yNjhDMTAuNzUxLjk0MSA3Ljk4Mi44NDYgNy42NDMuODQ0SDcuNjRjLS4zMzkuMDAyLTMuMTA3LjA5Ny00LjU2OCAyLjcxLS40NzkuNzgyLS41NDMgMi4xMDYtLjUyMyAyLjI2Ny0uMDQ2LjA3NC0uMjY3LjMwOC0uMzEuOTEyLS4wNDQuNDAzLjAxOC41MTctLjAxMi42Ny0uMTkyLjI4NC0uNDEzLjQ3My0uNjA1Ljc1Ni0uNDI2LjY3Ny0uNzk3IDEuMTk2LS44MDYgMi4xNTMtLjAwNy43MTQuMTYyIDEuNjg3LjY2MyAxLjcuMTU4LS4wMTIuMjkyLS4xMTcuNTY2LS40MjQuMDgyLS4wOTIuMzctLjQ4LjQyOS0uNTg3LjA1Ni4xNDguMTkgMS4xODMgMS4xMiAxLjcyMy0uOTU2LjQ1LTEuNDI0LjczNS0xLjQ0IDEuMzE5LjAyLjMzOC40MjMuNzg3IDEuMTY1Ljk5NmE2LjA1IDYuMDUgMCAwIDAgMi45MjcuMDVjLjUzNS0uMTMuNjk2LS4yNiAxLjM5Ni0uNjQ0LjcuMzg1Ljg2LjUxNCAxLjM5NS42NDNhNi4wNTIgNi4wNTIgMCAwIDAgMi45MjctLjA0OWMuNzQyLS4yMDkgMS4xNDYtLjY1OCAxLjE2Ni0uOTk2LS4wMTYtLjU4NC0uNDg0LS44Ny0xLjQ0LTEuMzIuOTMtLjUzOCAxLjA2My0xLjU3NCAxLjEyLTEuNzIyLjA1OC4xMDcuMzQ2LjQ5NS40MjguNTg3LjI3NC4zMDcuNDA5LjQxMi41NjcuNDI0LjUtLjAxMy42Ny0uOTg2LjY2My0xLjd6Ii8+Cjwvc3ZnPgo=)}.panel-btn.wechat-btn[data-v-19356a56]{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat.63e1ce0.svg)}.panel-btn.wechat-btn[data-v-19356a56]:hover{background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/wechat-hover.c8ce019.svg)}.panel-btn.wechat-btn:hover .wechat-qr-code-img[data-v-19356a56]{display:block}.share-title[data-v-19356a56]{margin:2.5rem 0 1rem;font-size:1rem;text-align:center;color:#c6c6c6;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.wechat-qr-code-img[data-v-19356a56]{position:absolute;top:100%;left:50%;width:8rem;height:8rem;margin-top:1rem;border:.5rem solid #fff;transform:translateX(-50%);display:none}
.extension[data-v-7e9c74a6]{position:fixed;bottom:0;left:0;z-index:1000;width:100%;height:180px;cursor:pointer;display:none}.extension[data-v-7e9c74a6]:before{display:flex;width:100%;position:absolute;bottom:0;z-index:0;height:148px;z-index:-1;content:"";background-color:#fff}.extension .link[data-v-7e9c74a6]{width:100%;height:100%;color:#000;background-repeat:no-repeat;background-image:url(//s3.pstatp.com/toutiao/xitu_juejin_web/img/extension.c1307da.png);background-position:bottom;background-size:auto 180px;image-rendering:-webkit-optimize-contrast}.extension .link .price[data-v-7e9c74a6]{margin-left:5px;margin-right:5px;color:#007fff}.extension .link .description[data-v-7e9c74a6],.extension .link .title[data-v-7e9c74a6]{font-size:26px;padding-top:50px;box-sizing:border-box;width:960px;margin:0 auto;padding-left:22px}.extension .link .description[data-v-7e9c74a6]{color:rgba(0,0,0,.7);font-size:13px;padding-top:8px}.extension .ion-close[data-v-7e9c74a6]{position:absolute;top:45px;right:15px;font-size:12px;color:#bbb}.extension .ion-close[data-v-7e9c74a6]:hover{color:#999}.books[data-v-7e9c74a6]{display:none;left:15px;right:15px;position:fixed;bottom:15px;z-index:900}.books.book--mobile[data-v-7e9c74a6]{bottom:55px}.books .book-inner[data-v-7e9c74a6]{width:100%;height:50px;padding-left:15px;padding-right:15px;display:flex;justify-content:center;align-items:center;background:#fd4243;box-sizing:border-box;border-radius:2px;background:linear-gradient(108deg,#f87554,#f0232f);background:-webkit-linear-gradient(-12deg,#f87554,#f0232f)}.books .book-inner .icon[data-v-7e9c74a6]{width:38px}.books .book-inner .icon img[data-v-7e9c74a6]{width:100%;display:block}.books .book-inner .title[data-v-7e9c74a6]{flex-grow:1;padding-left:15px;color:#fff;font-size:15px}.books .book-inner .btn-get[data-v-7e9c74a6]{padding-left:15px;padding-right:15px;height:26px;line-height:26px;border-radius:2px;border:1px solid #fff;color:#fff}@media (max-width:960px){.books[data-v-7e9c74a6]{display:block}}@media (min-width:960px){.extension[data-v-7e9c74a6]{display:block}}</style>
  </head>
  <body >
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div id="juejin"><div class="global-component-box"><!----> <!----> <!----> <!----> <!----> <div class="emoji-barrage" data-v-68506677><!----></div> <!----> <!----> <div class="bind-phone-number-modal-box" data-v-06e234c4><div st:block="bindPhoneNumberModal" class="modal-mask" style="display:none;" data-v-06e234c4 data-v-06e234c4></div> <form class="bind-phone-number-form" style="display:none;" data-v-06e234c4 data-v-06e234c4><i title="关闭" class="close-btn ion-close-round" data-v-06e234c4></i> <h1 class="title" data-v-06e234c4>提示</h1> <h2 class="hint" data-v-06e234c4>根据我国<a href="http://www.cac.gov.cn/2016-11/07/c_1119867116.htm" target="_blank" style="color:#007fff">《网络安全法》</a>，您需要绑定手机号后才可在掘金社区内发布内容。</h2> <div class="input-group" data-v-06e234c4><div class="input-box dropdown-box" data-v-06e234c4><div class="dropdown-input-container" style="width:26%;" data-v-4e5eda86 data-v-06e234c4><div class="dropdown-input-box" data-v-4e5eda86><input autocomplete="off" value="86" data-v-4e5eda86> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgdmlld0JveD0iMCAwIDEyIDEyIj4KICAgIDxwYXRoIGZpbGw9IiM5OTkiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTYgNy42NTlsMy4xNDYtMy40OTZhLjQ2NS40NjUgMCAwIDEgLjcwOCAwIC42LjYgMCAwIDEgMCAuNzg1bC0zLjUgMy44OWEuNDY1LjQ2NSAwIDAgMS0uNzA4IDBsLTMuNS0zLjg5YS42LjYgMCAwIDEgMC0uNzg1LjQ2NS40NjUgMCAwIDEgLjcwOCAwTDYgNy42NTl6Ii8+Cjwvc3ZnPg==" class="arrow" style="transform:rotate(0deg);" data-v-4e5eda86></div> <div class="dropdown-pannel" style="display:none;" data-v-4e5eda86 data-v-4e5eda86><ul data-v-4e5eda86><li class="item selected" data-v-4e5eda86><span data-v-4e5eda86>中国</span> <span data-v-4e5eda86>+86</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国澳门</span> <span data-v-4e5eda86>+853</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国台湾</span> <span data-v-4e5eda86>+886</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中国香港</span> <span data-v-4e5eda86>+852</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔巴尼亚</span> <span data-v-4e5eda86>+355</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿尔及利亚</span> <span data-v-4e5eda86>+213</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿富汗</span> <span data-v-4e5eda86>+93</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿根廷</span> <span data-v-4e5eda86>+54</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿拉伯联合酋长国</span> <span data-v-4e5eda86>+971</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿鲁巴岛</span> <span data-v-4e5eda86>+297</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿曼</span> <span data-v-4e5eda86>+968</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿塞拜疆</span> <span data-v-4e5eda86>+994</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>阿森松</span> <span data-v-4e5eda86>+247</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃及</span> <span data-v-4e5eda86>+20</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>埃塞俄比亚</span> <span data-v-4e5eda86>+251</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱尔兰</span> <span data-v-4e5eda86>+353</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>爱沙尼亚</span> <span data-v-4e5eda86>+372</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安道尔</span> <span data-v-4e5eda86>+376</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安哥拉</span> <span data-v-4e5eda86>+244</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安圭拉</span> <span data-v-4e5eda86>+1264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>安提瓜和巴布达</span> <span data-v-4e5eda86>+1268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥地利</span> <span data-v-4e5eda86>+43</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>奥兰群岛</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>澳大利亚</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴巴多斯</span> <span data-v-4e5eda86>+1246</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴哈马</span> <span data-v-4e5eda86>+1242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴基斯坦</span> <span data-v-4e5eda86>+92</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拉圭</span> <span data-v-4e5eda86>+595</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴勒斯坦</span> <span data-v-4e5eda86>+970</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴林</span> <span data-v-4e5eda86>+973</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴拿马</span> <span data-v-4e5eda86>+507</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>巴西</span> <span data-v-4e5eda86>+55</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>白俄罗斯</span> <span data-v-4e5eda86>+375</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>百慕大</span> <span data-v-4e5eda86>+1441</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>保加利亚</span> <span data-v-4e5eda86>+359</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>北马里亚纳群岛</span> <span data-v-4e5eda86>+1670</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>贝宁</span> <span data-v-4e5eda86>+229</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>比利时</span> <span data-v-4e5eda86>+32</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冰岛</span> <span data-v-4e5eda86>+354</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波多黎各</span> <span data-v-4e5eda86>+1787</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波黑</span> <span data-v-4e5eda86>+387</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>波兰</span> <span data-v-4e5eda86>+48</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>玻利维亚</span> <span data-v-4e5eda86>+591</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伯利兹</span> <span data-v-4e5eda86>+501</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>博茨瓦纳</span> <span data-v-4e5eda86>+267</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>不丹</span> <span data-v-4e5eda86>+975</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布基拉法索</span> <span data-v-4e5eda86>+226</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>布隆迪</span> <span data-v-4e5eda86>+257</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>朝鲜</span> <span data-v-4e5eda86>+850</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赤道几内亚</span> <span data-v-4e5eda86>+240</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>丹麦</span> <span data-v-4e5eda86>+45</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>德国</span> <span data-v-4e5eda86>+49</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多哥</span> <span data-v-4e5eda86>+228</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼加共和国</span> <span data-v-4e5eda86>+1809</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>多米尼克</span> <span data-v-4e5eda86>+1767</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>俄罗斯</span> <span data-v-4e5eda86>+7</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄瓜多尔</span> <span data-v-4e5eda86>+593</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>厄立特里亚</span> <span data-v-4e5eda86>+291</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法国</span> <span data-v-4e5eda86>+33</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法罗群岛</span> <span data-v-4e5eda86>+298</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属波利尼西亚</span> <span data-v-4e5eda86>+689</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>法属圭亚那</span> <span data-v-4e5eda86>+594</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>梵蒂冈</span> <span data-v-4e5eda86>+379</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>菲律宾</span> <span data-v-4e5eda86>+63</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斐济</span> <span data-v-4e5eda86>+679</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>芬兰</span> <span data-v-4e5eda86>+358</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>佛得角</span> <span data-v-4e5eda86>+238</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>冈比亚</span> <span data-v-4e5eda86>+220</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果</span> <span data-v-4e5eda86>+242</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>刚果民主共和国</span> <span data-v-4e5eda86>+243</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥伦比亚</span> <span data-v-4e5eda86>+57</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>哥斯达黎加</span> <span data-v-4e5eda86>+506</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格林纳达</span> <span data-v-4e5eda86>+1473</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格陵兰岛</span> <span data-v-4e5eda86>+299</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>格鲁吉亚</span> <span data-v-4e5eda86>+995</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瓜德罗普</span> <span data-v-4e5eda86>+590</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>关岛</span> <span data-v-4e5eda86>+1671</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圭亚那</span> <span data-v-4e5eda86>+592</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>海地</span> <span data-v-4e5eda86>+509</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>韩国</span> <span data-v-4e5eda86>+82</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷兰</span> <span data-v-4e5eda86>+31</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>荷属安的列斯</span> <span data-v-4e5eda86>+599</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>洪都拉斯</span> <span data-v-4e5eda86>+504</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉布提</span> <span data-v-4e5eda86>+253</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加拿大</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>吉尔吉斯斯坦</span> <span data-v-4e5eda86>+996</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>几内亚</span> <span data-v-4e5eda86>+224</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加那利群岛</span> <span data-v-4e5eda86>+3491</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加纳</span> <span data-v-4e5eda86>+233</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>加蓬</span> <span data-v-4e5eda86>+241</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>柬埔寨</span> <span data-v-4e5eda86>+855</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>捷克</span> <span data-v-4e5eda86>+420</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>喀麦隆</span> <span data-v-4e5eda86>+237</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卡塔尔</span> <span data-v-4e5eda86>+974</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>开曼群岛</span> <span data-v-4e5eda86>+1345</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科摩罗</span> <span data-v-4e5eda86>+269</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科索沃</span> <span data-v-4e5eda86>+883</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科特迪瓦</span> <span data-v-4e5eda86>+225</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>科威特</span> <span data-v-4e5eda86>+965</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>克罗地亚</span> <span data-v-4e5eda86>+385</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>肯尼亚</span> <span data-v-4e5eda86>+254</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>拉脱维亚</span> <span data-v-4e5eda86>+371</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莱索托</span> <span data-v-4e5eda86>+266</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>老挝</span> <span data-v-4e5eda86>+856</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>黎巴嫩</span> <span data-v-4e5eda86>+961</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>立陶宛</span> <span data-v-4e5eda86>+370</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比里亚</span> <span data-v-4e5eda86>+231</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>利比亚</span> <span data-v-4e5eda86>+218</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>列支敦士登</span> <span data-v-4e5eda86>+423</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>留尼旺岛</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢森堡</span> <span data-v-4e5eda86>+352</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>卢旺达</span> <span data-v-4e5eda86>+250</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>罗马尼亚</span> <span data-v-4e5eda86>+40</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马达加斯加</span> <span data-v-4e5eda86>+261</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马尔代夫</span> <span data-v-4e5eda86>+960</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马耳他</span> <span data-v-4e5eda86>+356</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马拉维</span> <span data-v-4e5eda86>+265</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马来西亚</span> <span data-v-4e5eda86>+60</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马里</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马其顿</span> <span data-v-4e5eda86>+389</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马绍尔群岛</span> <span data-v-4e5eda86>+692</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马提尼克</span> <span data-v-4e5eda86>+596</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>马约特</span> <span data-v-4e5eda86>+262</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里求斯</span> <span data-v-4e5eda86>+230</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>毛里塔尼亚</span> <span data-v-4e5eda86>+222</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美国</span> <span data-v-4e5eda86>+1</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属萨摩亚</span> <span data-v-4e5eda86>+1684</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>美属维尔京群岛</span> <span data-v-4e5eda86>+1340</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙古</span> <span data-v-4e5eda86>+976</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙塞拉特岛</span> <span data-v-4e5eda86>+1664</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>蒙特內哥羅</span> <span data-v-4e5eda86>+382</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>孟加拉国</span> <span data-v-4e5eda86>+880</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>秘鲁</span> <span data-v-4e5eda86>+51</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>密克罗尼西亚联邦</span> <span data-v-4e5eda86>+691</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>缅甸</span> <span data-v-4e5eda86>+95</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩尔多瓦</span> <span data-v-4e5eda86>+373</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩洛哥</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>摩纳哥</span> <span data-v-4e5eda86>+377</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>莫桑比克</span> <span data-v-4e5eda86>+258</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>墨西哥</span> <span data-v-4e5eda86>+52</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>纳米比亚</span> <span data-v-4e5eda86>+264</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>南非</span> <span data-v-4e5eda86>+27</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼泊尔</span> <span data-v-4e5eda86>+977</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼加拉瓜</span> <span data-v-4e5eda86>+505</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日尔</span> <span data-v-4e5eda86>+227</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>尼日利亚</span> <span data-v-4e5eda86>+234</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>挪威</span> <span data-v-4e5eda86>+47</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>帕劳</span> <span data-v-4e5eda86>+680</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>葡萄牙</span> <span data-v-4e5eda86>+351</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>千里达及托巴哥</span> <span data-v-4e5eda86>+1868</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>日本</span> <span data-v-4e5eda86>+81</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞典</span> <span data-v-4e5eda86>+46</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>瑞士</span> <span data-v-4e5eda86>+41</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣诞岛</span> <span data-v-4e5eda86>+61</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣基茨和尼维斯</span> <span data-v-4e5eda86>+1869</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣卢西亚</span> <span data-v-4e5eda86>+1758</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+223</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣马力诺</span> <span data-v-4e5eda86>+378</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣皮埃尔和密克隆群岛</span> <span data-v-4e5eda86>+508</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>圣文森特和格林纳丁斯</span> <span data-v-4e5eda86>+1784</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯里兰卡</span> <span data-v-4e5eda86>+94</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛伐克</span> <span data-v-4e5eda86>+421</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯洛文尼亚</span> <span data-v-4e5eda86>+386</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>斯威士兰</span> <span data-v-4e5eda86>+268</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏丹</span> <span data-v-4e5eda86>+249</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>苏里南</span> <span data-v-4e5eda86>+597</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>索马里</span> <span data-v-4e5eda86>+252</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塔吉克斯坦</span> <span data-v-4e5eda86>+992</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>沙特阿拉伯</span> <span data-v-4e5eda86>+966</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞舌尔</span> <span data-v-4e5eda86>+248</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞浦路斯</span> <span data-v-4e5eda86>+357</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞内加尔</span> <span data-v-4e5eda86>+221</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞拉利昂</span> <span data-v-4e5eda86>+232</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>塞尔维亚</span> <span data-v-4e5eda86>+381</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>萨尔瓦多</span> <span data-v-4e5eda86>+503</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>汤加</span> <span data-v-4e5eda86>+676</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>坦桑尼亚</span> <span data-v-4e5eda86>+255</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>泰国</span> <span data-v-4e5eda86>+66</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>特克斯和凯科斯群岛</span> <span data-v-4e5eda86>+1649</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>突尼斯</span> <span data-v-4e5eda86>+216</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>图瓦卢</span> <span data-v-4e5eda86>+688</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>土耳其</span> <span data-v-4e5eda86>+90</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>土库曼斯坦</span> <span data-v-4e5eda86>+993</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌兹别克斯坦</span> <span data-v-4e5eda86>+998</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌拉圭</span> <span data-v-4e5eda86>+598</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌克兰</span> <span data-v-4e5eda86>+380</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乌干达</span> <span data-v-4e5eda86>+256</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>文莱</span> <span data-v-4e5eda86>+673</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>委内瑞拉</span> <span data-v-4e5eda86>+58</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>危地马拉</span> <span data-v-4e5eda86>+502</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>叙利亚</span> <span data-v-4e5eda86>+963</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>匈牙利</span> <span data-v-4e5eda86>+36</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新西兰</span> <span data-v-4e5eda86>+64</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新喀里多尼亚</span> <span data-v-4e5eda86>+687</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>新加坡</span> <span data-v-4e5eda86>+65</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>希腊</span> <span data-v-4e5eda86>+30</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西萨摩亚</span> <span data-v-4e5eda86>+685</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西撒哈拉</span> <span data-v-4e5eda86>+212</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>西班牙</span> <span data-v-4e5eda86>+34</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>越南</span> <span data-v-4e5eda86>+84</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>约旦</span> <span data-v-4e5eda86>+962</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英属维尔京群岛</span> <span data-v-4e5eda86>+1284</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>英国</span> <span data-v-4e5eda86>+44</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度尼西亚</span> <span data-v-4e5eda86>+62</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>印度</span> <span data-v-4e5eda86>+91</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>意大利</span> <span data-v-4e5eda86>+39</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>以色列</span> <span data-v-4e5eda86>+972</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊朗</span> <span data-v-4e5eda86>+98</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>伊拉克</span> <span data-v-4e5eda86>+964</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>也门</span> <span data-v-4e5eda86>+967</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>亚美尼亚</span> <span data-v-4e5eda86>+374</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>牙买加</span> <span data-v-4e5eda86>+1876</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>中非</span> <span data-v-4e5eda86>+236</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>智利</span> <span data-v-4e5eda86>+56</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>直布罗陀</span> <span data-v-4e5eda86>+350</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>乍得</span> <span data-v-4e5eda86>+235</span></li><li class="item" data-v-4e5eda86><span data-v-4e5eda86>赞比亚</span> <span data-v-4e5eda86>+260</span></li></ul></div></div> <input maxlength="11" placeholder="请输入要绑定的手机号码" value="" class="input number-input" data-v-06e234c4></div> <div class="input-box vcode-box" data-v-06e234c4></div> <div class="input-box" data-v-06e234c4><input maxlength="4" placeholder="验证码" value="" class="input" data-v-06e234c4> <button class="send-vcode-btn" data-v-06e234c4>
            获取验证码
          </button></div></div> <button st:name="bindBtn" class="btn" data-v-06e234c4>
        绑定手机
      </button></form></div> <!----></div> <!----> <div class="view-container" data-v-6a3e47cf data-v-064b8453><div class="main-header-box" data-v-6a3e47cf><header class="main-header main-header unauthorized visible" data-v-6f082a2c data-v-6a3e47cf><div class="container" data-v-6f082a2c><a href="/" class="logo" data-v-6f082a2c><img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/logo.a7995ad.svg" alt="掘金" class="logo-img" data-v-6f082a2c> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQ1cHgiIGhlaWdodD0iMzhweCIgdmlld0JveD0iMCAwIDQ1IDM4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPHRpdGxlPkp1ZWppbjwvdGl0bGU+CiAgICA8ZGVzYz5KdWVqaW4uaW08L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iMC4xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iR3JvdXAtMTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCA1LjAwMDAwMCkiIGZpbGw9IiMwMDZDRkYiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjEuMjkzNDMyOCwyLjU4MzEzMDQ5IEwxOC4wMTczOTg0LDAgTDE0LjU5NDYyNCwyLjY5ODg3ODAxIEwxNC40MTcyMDc3LDIuODQxODIzMDQgTDE4LjAxNzM5ODQsNS43MTI0MjQ4MyBMMjEuNjI4NjU3OCwyLjg0MTgyMzA0IEwyMS4yOTM0MzI4LDIuNTgzMTMwNDkgWiBNMzMuNzA3ODI4OSwxMi42MDA2Njc0IEwxOC4wMDc5MTA5LDI0Ljk4MDI3NiBMMi4zMTc0ODA0NCwxMi42MDgyNTc0IEwwLDE0LjQ2OTcwNTIgTDE4LjAwNzkxMDksMjguNjY5MDE2NyBMMzYuMDI1NjI1NiwxNC40NjIxMTUyIEwzMy43MDc4Mjg5LDEyLjYwMDY2NzQgWiBNMTguMDA3OTEwOSwxMy42MDUwNzc2IEw5LjQ2NDQxNTU0LDYuODY4NjM1MDUgTDcuMTQ2NjE4ODUsOC43MzAwODI5IEwxOC4wMDc5MTA5LDE3LjI5NDEzNDUgTDI4Ljg3ODM3NDIsOC43MjI0OTI5IEwyNi41NjA1Nzc1LDYuODYxMDQ1MDUgTDE4LjAwNzkxMDksMTMuNjA1MDc3NiBaIiBpZD0iRmlsbC0xLUNvcHkiPjwvcGF0aD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==" alt="掘金" class="mobile" data-v-6f082a2c></a> <nav role="navigation" class="main-nav" data-v-6f082a2c><ul class="nav-list" data-v-6f082a2c><li class="main-nav-list" data-v-6f082a2c><div class="phone-show-menu" data-v-6f082a2c><span data-v-6f082a2c>首页</span> <div class="icon ion-arrow-down-b" data-v-6f082a2c></div></div> <ul class="phone-hide" data-v-6f082a2c><li class="nav-item link-item route-active" data-v-6f082a2c><a href="/" data-v-6f082a2c>首页</a></li> <li class="nav-item link-item activities" data-v-6f082a2c><a href="/pins" data-v-6f082a2c>沸点</a></li> <li class="nav-item link-item" data-v-6f082a2c><a href="/topics" data-v-6f082a2c>话题</a></li> <li class="nav-item link-item book" data-v-6f082a2c><a href="/books" data-v-6f082a2c>小册</a></li> <li class="nav-item link-item" data-v-6f082a2c><a href="/events/all" data-v-6f082a2c>活动</a></li> <li class="nav-item link-item" data-v-6f082a2c><a href="/academy" data-v-6f082a2c>字学</a></li></ul></li> <li class="nav-item search" data-v-6f082a2c><form role="search" class="search-form" data-v-6f082a2c><input type="search" maxlength="32" placeholder="探索掘金" value="" class="search-input" data-v-6f082a2c> <img src="//s3.pstatp.com/toutiao/xitu_juejin_web/img/juejin-search-icon.6f8ba1b.svg" alt="搜索" class="search-icon" data-v-6f082a2c></form></li> <li class="nav-item add" data-v-6f082a2c><div class="add-group" data-v-6f082a2c><button class="add-btn" data-v-6f082a2c>写文章</button> <div class="more" data-v-6f082a2c><i class="more-icon ion-android-arrow-dropdown" data-v-6f082a2c></i></div> <ul class="more-list" data-v-6f082a2c><li class="item" data-v-6f082a2c>发布沸点</li> <!----></ul></div> <!----></li> <!----> <!----> <li class="nav-item auth" data-v-6f082a2c><button class="login-button" data-v-6f082a2c>登录</button></li></ul></nav></div></header></div>  <main class="container main-container" style="max-width:;" data-v-6a3e47cf><div class="view column-view" data-v-6a3e47cf data-v-064b8453><div class="main-area article-area shadow" data-v-6a3e47cf data-v-064b8453><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="6875739447254581262" data-draft-id="6875738877009592333" class="article" data-v-064b8453><!----> <meta itemprop="headline" content="这三年被分布式坑惨了，曝光十大坑 | 🏆 技术专题第五期征文"> <meta itemprop="keywords" content="分布式"> <meta itemprop="datePublished" content="2020-09-23T17:44:14.000Z"> <meta itemprop="image" content="https://b-gold-cdn.xitu.io/icon/icon-128.png"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悟空聊架构"> <meta itemprop="url" content="https://juejin.im/user/3773179639893229"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://b-gold-cdn.xitu.io/icon/icon-white-180.png"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <div class="author-info-block" data-v-064b8453><a href="/user/3773179639893229" target="_blank" rel="" class="avatar-link" data-v-064b8453><div data-src="https://user-gold-cdn.xitu.io/2020/4/5/1714a695db6cd109?imageView2/1/w/100/h/100/q/85/interlace/1" class="lazy avatar avatar" style="background-image:none;" data-v-47cc2604 data-v-1c418ef0 data-v-064b8453></div></a> <div class="author-info-box" data-v-064b8453><!----> <div class="meta-box" data-v-064b8453><time datetime="2020-09-23T17:44:14.000Z" title="Thu Sep 24 2020 01:44:14 GMT+0800 (China Standard Time)" class="time" data-v-064b8453>
                  2020年09月24日
                </time> <span class="views-count" data-v-064b8453>阅读 2186</span> <!----></div></div> <button class="follow-button follow" data-v-06c7d5b3 data-v-064b8453><span data-v-06c7d5b3>关注</span></button></div> <div data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29308d5da0d04b98abe30d510df9f94a~tplv-k3u1fbpfcp-zoom-1.image" class="lazy thumb article-hero" style="background-image:none;background-size:cover;" data-v-47cc2604 data-v-7b344634 data-v-064b8453></div> <h1 class="article-title" data-v-064b8453><!---->
            这三年被分布式坑惨了，曝光十大坑 | 🏆 技术专题第五期征文
          </h1> <div itemprop="articleBody" class="article-content" data-v-064b8453><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><p>本篇主要内容如下：</p>
<p><img alt="主要内容" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01ed0519820547948ebc156509922ca6~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h1 data-id="heading-0">前言</h1>
<p>我们都在讨论分布式，特别是面试的时候，不管是招初级软件工程师还是高级，都会要求懂分布式，甚至要求用过。传得沸沸扬扬的分布式到底是什么东东，有什么优势？</p>
<h3 data-id="heading-1">借用火影忍术</h3>
<p><img alt="风遁 螺旋手里剑" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d167cd4524c4af09343dc8069ee5ce1~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>看过<code>火影</code>的同学肯定知道<code>漩涡鸣人</code>的招牌忍术：<code>多重影分身之术</code>。</p>
<ul>
<li>这个术有一个特别厉害的地方，<code>过程和心得</code>：多个分身的感受和经历都是相通的。比如 A 分身去找卡卡西（鸣人的老师）请教问题，那么其他分身也会知道 A 分身问的什么问题。</li>
<li><code>漩涡鸣人</code>有另外一个超级厉害的忍术，需要由几个影分身完成：<code>风遁·螺旋手里剑</code>。这个忍术是靠三个鸣人一起协作完成的。</li>
</ul>
<p>这两个忍术和分布式有什么关系？</p>
<ul>
<li>
<p>分布在不同地方的系统或服务，是彼此相互关联的。</p>
</li>
<li>
<p>分布式系统是分工合作的。</p>
</li>
</ul>
<p>案例：</p>
<ul>
<li>比如 Redis 的<code>哨兵机制</code>，可以知道集群环境下哪台 <code>Redis</code> 节点挂了。</li>
<li>Kafka的 <code>Leader 选举机制</code>，如果某个节点挂了，会从 <code>follower</code> 中重新选举一个 leader 出来。（leader 作为写数据的入口，follower 作为读的入口）</li>
</ul>
<p>那<code>多重影分身之术</code>有什么缺点？</p>
<ul>
<li>会消耗大量的查克拉。分布式系统同样具有这个问题，需要几倍的资源来支持。</li>
</ul>
<h3 data-id="heading-2">对分布式的通俗理解</h3>
<ul>
<li>是一种工作方式</li>
<li>若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统</li>
<li>将不同的业务分布在不同的地方</li>
</ul>
<h3 data-id="heading-3">优势可以从两方面考虑：一个是宏观，一个是微观。</h3>
<ul>
<li>宏观层面：多个功能模块糅合在一起的系统进行服务拆分，来解耦服务间的调用。</li>
<li>微观层面：将模块提供的服务分布到不同的机器或容器里，来扩大服务力度。</li>
</ul>
<h3 data-id="heading-4">任何事物有阴必有阳，那分布式又会带来哪些问题呢？</h3>
<ul>
<li>需要更多优质人才懂分布式，人力成本增加</li>
<li>架构设计变得异常复杂，学习成本高</li>
<li>运维部署和维护成本显著增加</li>
<li>多服务间链路变长，开发排查问题难度加大</li>
<li>环境高可靠性问题</li>
<li>数据幂等性问题</li>
<li>数据的顺序问题</li>
<li>等等</li>
</ul>
<p>讲到<code>分布式</code>不得不知道 <code>CAP</code> 定理和 <code>Base</code> 理论，这里给不知道的同学做一个扫盲。</p>
<h3 data-id="heading-5">CAP 定理</h3>
<p>在理论计算机科学中，CAP 定理指出对于一个分布式计算系统来说，不可能通是满足以下三点：</p>
<ul>
<li><strong>一致性（Consistency）</strong>
<ul>
<li>所有节点访问同一份最新的数据副本。</li>
</ul>
</li>
<li><strong>可用性（Availability）</strong>
<ul>
<li>每次请求都能获取到非错的响应，但不保证获取的数据为最新数据</li>
</ul>
</li>
<li><strong>分区容错性（Partition tolerance）</strong>
<ul>
<li>不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">BASE 理论</h3>
<p><code>BASE</code> 是 <code>Basically Available</code>（基本可用）、<code>Soft state</code>（软状态）和 <code>Eventually consistent</code>（最终一致性）三个短语的缩写。<code>BASE</code> 理论是对 <code>CAP </code> 中 <code>AP</code> 的一个扩展，通过牺牲强一致性来获得可用性，当出现故障允许部分不可用但要保证核心功能可用，允许数据在一段时间内是不一致的，但最终达到一致状态。满足 <code>BASE</code> 理论的事务，我们称之为<code>柔性事务</code>。</p>
<ul>
<li><strong>基本可用 ：</strong> 分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。如电商网址交易付款出现问题来，商品依然可以正常浏览。</li>
<li><strong>软状态：</strong> 由于不要求强一致性，所以BASE允许系统中存在中间状态（也叫软状态），这个状态不影响系统可用性，如订单中的“支付中”、“数据同步中”等状态，待数据最终一致后状态改为“成功”状态。</li>
<li><strong>最终一致性：</strong> 最终一致是指的经过一段时间后，所有节点数据都将会达到一致。如订单的“支付中”状态，最终会变为“支付成功”或者“支付失败”，使订单状态与实际交易结果达成一致，但需要一定时间的延迟、等待。</li>
</ul>
<h1 data-id="heading-7">一、分布式消息队列的坑</h1>
<h3 data-id="heading-8">消息队列如何做分布式？</h3>
<p>将消息队列里面的消息分摊到多个节点（指某台机器或容器）上，所有节点的消息队列之和就包含了所有消息。</p>
<h2 data-id="heading-9">1. 消息队列的坑之非幂等</h2>
<h3 data-id="heading-10">（1）幂等性概念</h3>
<p>所谓幂等性就是无论多少次操作和第一次的操作结果一样。如果消息被多次消费，很有可能造成数据的不一致。而如果消息不可避免地被消费多次，如果我们开发人员能通过技术手段保证数据的前后一致性，那也是可以接受的，这让我想起了 Java 并发编程中的 ABA 问题，如果出现了 [ABA 问题](<a href="https://juejin.im/post/6864945088721027079" target="_blank">用积木讲解 ABA 原理 | 老婆居然又听懂了！</a>)，若能保证所有数据的前后一致性也能接受。</p>
<h3 data-id="heading-11">（2）场景分析</h3>
<p><code>RabbitMQ</code>、<code>RocketMQ</code>、<code>Kafka</code> 消息队列中间件都有可能出现消息重复消费问题。这种问题并不是 MQ 自己保证的，而是需要开发人员来保证。</p>
<p>这几款消息队列中间都是是全球最牛的分布式消息队列，那肯定考虑到了消息的幂等性。我们以 Kafka 为例，看看 Kafka 是怎么保证消息队列的幂等性。</p>
<p>Kafka 有一个 <code>偏移量</code> 的概念，代表着消息的序号，每条消息写到消息队列都会有一个偏移量，消费者消费了数据之后，每过一段固定的时间，就会把消费过的消息的偏移量提交一下，表示已经消费过了，下次消费就从偏移量后面开始消费。</p>
<blockquote>
<p><code>坑：</code>当消费完消息后，还没来得及提交偏移量，系统就被关机了，那么未提交偏移量的消息则会再次被消费。</p>
</blockquote>
<p>如下图所示，队列中的数据 A、B、C，对应的偏移量分别为 100、101、102，都被消费者消费了，但是只有数据 A 的偏移量 100 提交成功，另外 2 个偏移量因系统重启而导致未及时提交。</p>
<p><img alt="系统重启，偏移量未提交" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/678db990060545389720a20b6de58a78~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>重启后，消费者又是拿偏移量 100 以后的数据，从偏移量 101 开始拿消息。所以数据 B 和数据 C 被重复消息。</p>
<p>如下图所示：</p>
<p><img alt="重启后，重复消费消息" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efb9c03422bd446aafe3d15a301058b2~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h3 data-id="heading-12">（3）避坑指南</h3>
<ul>
<li>微信支付结果通知场景
<ul>
<li>微信官方文档上提到微信支付通知结果可能会推送多次，需要开发者自行保证幂等性。第一次我们可以直接修改订单状态（如支付中 -> 支付成功），第二次就根据订单状态来判断，如果不是支付中，则不进行订单处理逻辑。</li>
</ul>
</li>
<li>插入数据库场景
<ul>
<li>每次插入数据时，先检查下数据库中是否有这条数据的主键 id，如果有，则进行更新操作。</li>
</ul>
</li>
<li>写 Redis 场景
<ul>
<li>Redis 的 <code>Set</code> 操作天然幂等性，所以不用考虑 Redis 写数据的问题。</li>
</ul>
</li>
<li>其他场景方案
<ul>
<li>生产者发送每条数据时，增加一个全局唯一 id，类似订单 id。每次消费时，先去 Redis 查下是否有这个 id，如果没有，则进行正常处理消息，且将 id 存到 Redis。如果查到有这个 id，说明之前消费过，则不要进行重复处理这条消息。</li>
<li>不同业务场景，可能会有不同的幂等性方案，大家选择合适的即可，上面的几种方案只是提供常见的解决思路。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">2. 消息队列的坑之消息丢失</h2>
<blockquote>
<p><code>坑:</code>消息丢失会带来什么问题？如果是订单下单、支付结果通知、扣费相关的消息丢失，则可能造成财务损失，如果量很大，就会给甲方带来巨大损失。</p>
</blockquote>
<p>那消息队列是否能保证消息不丢失呢？答案：否。主要有三种场景会导致消息丢失。</p>
<p><img alt="消息队列之消息丢失" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c444b2838f8d4d92ad3c56ecb46ed675~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h3 data-id="heading-14">（1）生产者存放消息的过程中丢失消息</h3>
<p><img alt="生产者丢失消息" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/80bf3723352843cbbc82133d8ff0e130~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h4 data-id="heading-15">解决方案</h4>
<ul>
<li>事务机制（不推荐，异步方式）</li>
</ul>
<p>对于 RabbitMQ 来说，生产者发送数据之前开启 RabbitMQ 的<strong>事务机制</strong><code>channel.txselect</code> ，如果消息没有进队列，则生产者受到异常报错，并进行回滚 <code>channel.txRollback</code>，然后重试发送消息；如果收到了消息，则可以提交事务 <code>channel.txCommit</code>。但这是一个同步的操作，会影响性能。</p>
<ul>
<li>confirm 机制（推荐，异步方式）</li>
</ul>
<p>我们可以采用另外一种模式： <code>confirm</code> 模式来解决同步机制的性能问题。每次生产者发送的消息都会分配一个唯一的 id，如果写入到了 RabbitMQ 队列中，则 RabbitMQ 会回传一个 <code>ack</code> 消息，说明这个消息接收成功。如果 RabbitMQ 没能处理这个消息，则回调 <code>nack</code> 接口。说明需要重试发送消息。</p>
<p>也可以自定义超时时间 + 消息 id 来实现超时等待后重试机制。但可能出现的问题是调用 ack 接口时失败了，所以会出现消息被发送两次的问题，这个时候就需要保证消费者消费消息的幂等性。</p>
<h4 data-id="heading-16"><code>事务模式</code> 和 <code>confirm</code> 模式的区别：</h4>
<ul>
<li>事务机制是同步的，提交事务后悔被<strong>阻塞</strong>直到提交事务完成后。</li>
<li>confirm 模式异步接收通知，但可能<strong>接收不到通知</strong>。需要考虑接收不到通知的场景。</li>
</ul>
<h3 data-id="heading-17">（2）消息队列丢失消息</h3>
<p><img alt="消息队列丢失消息" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/496ffed09a34431991bab1de7054d8a9~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>消息队列的消息可以放到内存中，或将内存中的消息转到硬盘（比如数据库）中，一般都是内存和硬盘中都存有消息。如果只是放在内存中，那么当机器重启了，消息就全部丢失了。如果是硬盘中，则可能存在一种极端情况，就是将内存中的数据转换到硬盘的期间中，消息队列出问题了，未能将消息持久化到硬盘。</p>
<p><strong>解决方案</strong></p>
<ul>
<li>创建 <code>Queue</code> 的时候将其设置为持久化。这个地方没搞懂，欢迎探讨解答。</li>
<li>发送消息的时候将消息的 <code>deliveryMode</code> 设置为 2 。</li>
<li>开启生产者 <code>confirm</code> 模式，可以重试发送消息。</li>
</ul>
<h3 data-id="heading-18">（3）消费者丢失消息</h3>
<p><img alt="消费者丢失消息" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ef429275fe84923974035a5f88dbc7a~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>消费者刚拿到数据，还没开始处理消息，结果进程因为异常退出了，消费者没有机会再次拿到消息。</p>
<p><strong>解决方案</strong></p>
<ul>
<li>关闭 RabbitMQ 的自动 <code>ack</code>，每次生产者将消息写入消息队列后，就自动回传一个 <code>ack</code> 给生产者。</li>
<li>消费者处理完消息再主动 <code>ack</code>，告诉消息队列我处理完了。</li>
</ul>
<p><strong>问题：</strong> 那这种主动 <code>ack</code> 有什么漏洞了？如果 主动 <code>ack</code> 的时候挂了，怎么办？</p>
<p>则可能会被再次消费，这个时候就需要幂等处理了。</p>
<p><strong>问题：</strong> 如果这条消息一直被重复消费怎么办？</p>
<p>则需要有加上重试次数的监测，如果超过一定次数则将消息丢失，记录到异常表或发送异常通知给值班人员。</p>
<h3 data-id="heading-19">（4）RabbitMQ 消息丢失总结</h3>
<p><img alt="RabbitMQ 丢失消息的处理方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/756811711f934472a9edbc48eb603707~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h3 data-id="heading-20">（5）Kafka 消息丢失</h3>
<p><strong>场景：</strong><code>Kafka</code> 的某个 broker（节点）宕机了，重新选举 leader （写入的节点）。如果 leader 挂了，follower 还有些数据未同步完，则 follower 成为 leader 后，消息队列会丢失一部分数据。</p>
<p><strong>解决方案</strong></p>
<ul>
<li>给 topic 设置 <code>replication.factor</code> 参数，值必须大于 1，要求每个 partition 必须有至少 2 个副本。</li>
<li>给 kafka 服务端设置 <code>min.insyc.replicas</code> 必须大于 1，表示一个 leader 至少一个 follower 还跟自己保持联系。</li>
</ul>
<h2 data-id="heading-21">3. 消息队列的坑之消息乱序</h2>
<blockquote>
<p><code>坑:</code> 用户先下单成功，然后取消订单，如果顺序颠倒，则最后数据库里面会有一条下单成功的订单。</p>
</blockquote>
<p><strong>RabbitMQ 场景：</strong></p>
<ul>
<li>生产者向消息队列按照顺序发送了 2 条消息，消息1：增加数据 A，消息2：删除数据 A。</li>
<li>期望结果：数据 A 被删除。</li>
<li>但是如果有两个消费者，消费顺序是：消息2、消息 1。则最后结果是增加了数据 A。</li>
</ul>
<p><img alt="RabbitMQ消息乱序场景" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e4a83f8dfeb542dfa47295d121648604~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p><img alt="RabbitMQ 消息乱序场景" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3b00611a8e74f1d9696996c53ffd2cb~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p><strong>RabbitMQ 解决方案：</strong></p>
<ul>
<li>将 Queue 进行拆分，创建多个内存 Queue，消息 1 和 消息 2 进入同一个 Queue。</li>
<li>创建多个消费者，每一个消费者对应一个 Queue。</li>
</ul>
<p><img alt="RabbitMQ 解决方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54c37e64198f4cb98777b155955d3377~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p><strong>Kafka 场景：</strong></p>
<ul>
<li>创建了 topic，有 3 个 partition。</li>
<li>创建一条订单记录，订单 id 作为 key，订单相关的消息都丢到同一个 partition 中，同一个生产者创建的消息，顺序是正确的。</li>
<li>为了快速消费消息，会创建多个消费者去处理消息，而为了提高效率，每个消费者可能会创建多个线程来并行的去拿消息及处理消息，处理消息的顺序可能就乱序了。</li>
</ul>
<p><img alt="Kafka 消息丢失场景" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b56e9cbaad484eadb20f1e288f1bb535~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p><strong>Kafka 解决方案：</strong></p>
<ul>
<li>解决方案和 RabbitMQ 类似，利用多个 内存 Queue，每个线程消费 1个 Queue。</li>
<li>具有相同 key 的消息 进同一个 Queue。</li>
</ul>
<p><img alt="Kafka 消息乱序解决方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf58802508854d56829a7ecdcb158073~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h2 data-id="heading-22">4. 消息队列的坑之消息积压</h2>
<p>消息积压：消息队列里面有很多消息来不及消费。</p>
<p><strong>场景 1：</strong> 消费端出了问题，比如消费者都挂了，没有消费者来消费了，导致消息在队列里面不断积压。</p>
<p><strong>场景 2：</strong> 消费端出了问题，比如消费者消费的速度太慢了，导致消息不断积压。</p>
<blockquote>
<p>坑：比如线上正在做订单活动，下单全部走消息队列，如果消息不断积压，订单都没有下单成功，那么将会损失很多交易。</p>
</blockquote>
<p><img alt="消息队列之消息积压" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c4cf34f137843e1a5533a4395e7b9f1~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>解决方案：<strong>解铃还须系铃人</strong></p>
<ul>
<li>修复代码层面消费者的问题，确保后续消费速度恢复或尽可能加快消费的速度。</li>
<li>停掉现有的消费者。</li>
<li>临时建立好原先 5 倍的 Queue 数量。</li>
<li>临时建立好原先 5 倍数量的 消费者。</li>
<li>将堆积的消息全部转入临时的 Queue，消费者来消费这些 Queue。</li>
</ul>
<p><img alt="消息积压解决方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3596bdfff3f4a1697330e49bb7e0fa4~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h2 data-id="heading-23">5. 消息队列的坑之消息过期失效</h2>
<blockquote>
<p><code>坑：</code>RabbitMQ 可以设置过期时间，如果消息超过一定的时间还没有被消费，则会被 RabbitMQ 给清理掉。消息就丢失了。</p>
</blockquote>
<p><img alt="消息过期失效" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d455c4fbf2c84cf681659dfc02a40e05~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>解决方案：</p>
<ul>
<li>准备好批量重导的程序</li>
<li>手动将消息闲时批量重导</li>
</ul>
<p><img alt="消息过期失效解决方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96765f014404428c8965a70e8b8fd99a~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<h2 data-id="heading-24">6. 消息队列的坑之队列写满</h2>
<blockquote>
<p><code>坑：</code>当消息队列因消息积压导致的队列快写满，所以不能接收更多的消息了。生产者生产的消息将会被丢弃。</p>
</blockquote>
<p>解决方案：</p>
<ul>
<li>判断哪些是无用的消息，RabbitMQ 可以进行 <code>Purge Message</code> 操作。</li>
<li>如果是有用的消息，则需要将消息快速消费，将消息里面的内容转存到数据库。</li>
<li>准备好程序将转存在数据库中的消息再次重导到消息队列。</li>
<li>闲时重导消息到消息队列。</li>
</ul>
<h1 data-id="heading-25">二、分布式缓存的坑</h1>
<p>在高频访问数据库的场景中，我们会在业务层和数据层之间加入一套缓存机制，来分担数据库的访问压力，毕竟访问磁盘 I/O 的速度是很慢的。比如利用缓存来查数据，可能5ms就能搞定，而去查数据库可能需要 50 ms，差了一个数量级。而在高并发的情况下，数据库还有可能对数据进行加锁，导致访问数据库的速度更慢。</p>
<p>分布式缓存我们用的最多的就是 Redis了，它可以提供分布式缓存服务。</p>
<h2 data-id="heading-26">1. Redis 数据丢失的坑</h2>
<h3 data-id="heading-27">哨兵机制</h3>
<p>Redis 可以实现利用<code>哨兵机制</code>实现集群的高可用。那什么十哨兵机制呢？</p>
<ul>
<li>英文名：<code>sentinel</code>，中文名：<code>哨兵</code>。</li>
<li>集群监控：负责主副进程的正常工作。</li>
<li>消息通知：负责将故障信息报警给运维人员。</li>
<li>故障转移：负责将主节点转移到备用节点上。</li>
<li>配置中心：通知客户端更新主节点地址。</li>
<li>分布式：有多个哨兵分布在每个主备节点上，互相协同工作。</li>
<li>分布式选举：需要大部分哨兵都同意，才能进行主备切换。</li>
<li>高可用：即使部分哨兵节点宕机了，哨兵集群还是能正常工作。</li>
</ul>
<blockquote>
<p><code>坑：</code> 当主节点发生故障时，需要进行主备切换，可能会导致数据丢失。</p>
</blockquote>
<h3 data-id="heading-28">异步复制数据导致的数据丢失</h3>
<p>主节点异步同步数据给备用节点的过程中，主节点宕机了，导致有部分数据未同步到备用节点。而这个从节点又被选举为主节点，这个时候就有部分数据丢失了。</p>
<h3 data-id="heading-29">脑裂导致的数据丢失</h3>
<p>主节点所在机器脱离了集群网络，实际上自身还是运行着的。但哨兵选举出了备用节点作为主节点，这个时候就有两个主节点都在运行，相当于两个大脑在指挥这个集群干活，但到底听谁的呢？这个就是脑裂。</p>
<p>那怎么脑裂怎么会导致数据丢失呢？如果发生脑裂后，客户端还没来得及切换到新的主节点，连的还是第一个主节点，那么有些数据还是写入到了第一个主节点里面，新的主节点没有这些数据。那等到第一个主节点恢复后，会被作为备用节点连到集群环境，而且自身数据会被清空，重新从新的主节点复制数据。而新的主节点因没有客户端之前写入的数据，所以导致数据丢失了一部分。</p>
<h3 data-id="heading-30">避坑指南</h3>
<ul>
<li>配置 min-slaves-to-write 1，表示至少有一个备用节点。</li>
<li>配置 min-slaves-max-lag 10，表示数据复制和同步的延迟不能超过 10 秒。最多丢失 10 秒的数据</li>
</ul>
<p>注意：<code>缓存雪崩</code>、<code>缓存穿透</code>、<code>缓存击穿</code>并不是分布式所独有的，单机的时候也会出现。所以不在分布式的坑之列。</p>
<h1 data-id="heading-31">三、分库分表的坑</h1>
<h2 data-id="heading-32">1.分库分表的坑之扩容</h2>
<h4 data-id="heading-33">分库、分表、垂直拆分和水平拆分</h4>
<ul>
<li>
<p><strong>分库：</strong> 因一个数据库支持的最高并发访问数是有限的，可以将一个数据库的数据拆分到多个库中，来增加最高并发访问数。</p>
</li>
<li>
<p><strong>分表：</strong> 因一张表的数据量太大，用索引来查询数据都搞不定了，所以可以将一张表的数据拆分到多张表，查询时，只用查拆分后的某一张表，SQL 语句的查询性能得到提升。</p>
</li>
<li>
<p>分库分表优势：分库分表后，承受的并发增加了多倍；磁盘使用率大大降低；单表数据量减少，SQL 执行效率明显提升。</p>
</li>
<li>
<p><strong>水平拆分：</strong> 把一个表的数据拆分到多个数据库，每个数据库中的表结构不变。用多个库抗更高的并发。比如订单表每个月有500万条数据累计，每个月都可以进行水平拆分，将上个月的数据放到另外一个数据库。</p>
</li>
<li>
<p><strong>垂直拆分：</strong> 把一个有很多字段的表，拆分成多张表到同一个库或多个库上面。高频访问字段放到一张表，低频访问的字段放到另外一张表。利用数据库缓存来缓存高频访问的行数据。比如将一张很多字段的订单表拆分成几张表分别存不同的字段（可以有冗余字段）。</p>
</li>
<li>
<p><strong>分库、分表的方式：</strong></p>
<ul>
<li>根据租户来分库、分表。</li>
<li>利用时间范围来分库、分表。</li>
<li>利用 ID 取模来分库、分表。</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>坑：</code>分库分表是一个运维层面需要做的事情，有时会采取凌晨宕机开始升级。可能熬夜到天亮，结果升级失败，则需要回滚，其实对技术团队都是一种煎熬。</p>
</blockquote>
<h4 data-id="heading-34">怎么做成自动的来节省分库分表的时间？</h4>
<ul>
<li>双写迁移方案：迁移时，新数据的增删改操作在新库和老库都做一遍。</li>
<li>使用分库分表工具 Sharding-jdbc  来完成分库分表的累活。</li>
<li>使用程序来对比两个库的数据是否一致，直到数据一致。</li>
</ul>
<blockquote>
<p><code>坑:</code> 分库分表看似光鲜亮丽，但分库分表会引入什么新的问题呢？</p>
</blockquote>
<h4 data-id="heading-35">垂直拆分带来的问题</h4>
<ul>
<li>依然存在单表数据量过大的问题。</li>
<li>部分表无法关联查询，只能通过接口聚合方式解决，提升了开发的复杂度。</li>
<li>分布式事处理复杂。</li>
</ul>
<h4 data-id="heading-36">水平拆分带来的问题</h4>
<ul>
<li>跨库的关联查询性能差。</li>
<li>数据多次扩容和维护量大。</li>
<li>跨分片的事务一致性难以保证。</li>
</ul>
<h2 data-id="heading-37">2.分库分表的坑之唯一 ID</h2>
<h3 data-id="heading-38">为什么分库分表需要唯一 ID</h3>
<ul>
<li>如果要做分库分表，则必须得考虑表主键 ID 是全局唯一的，比如有一张订单表，被分到 A 库和 B 库。如果 两张订单表都是从 1 开始递增，那查询订单数据时就错乱了，很多订单 ID 都是重复的，而这些订单其实不是同一个订单。</li>
<li>分库的一个期望结果就是将访问数据的次数分摊到其他库，有些场景是需要均匀分摊的，那么数据插入到多个数据库的时候就需要交替生成唯一的 ID 来保证请求均匀分摊到所有数据库。</li>
</ul>
<blockquote>
<p><code>坑:</code> 唯一 ID 的生成方式有 n 种，各有各的用途，别用错了。</p>
</blockquote>
<h3 data-id="heading-39">生成唯一 ID 的原则</h3>
<ul>
<li>全局唯一性</li>
<li>趋势递增</li>
<li>单调递增</li>
<li>信息安全</li>
</ul>
<h3 data-id="heading-40">生成唯一 ID 的几种方式</h3>
<ul>
<li>
<p>数据库自增 ID。每个数据库每增加一条记录，自己的 ID 自增 1。</p>
<ul>
<li>缺点
<ul>
<li>多个库的 ID 可能重复，这个方案可以直接否掉了，不适合分库分表后的 ID 生成。</li>
<li>信息不安全</li>
</ul>
</li>
</ul>
</li>
<li>
<p>适用 <code>UUID</code> 唯一 ID。</p>
<ul>
<li>缺点
<ul>
<li>UUID 太长、占用空间大。</li>
<li>不具有有序性，作为主键时，在写入数据时，不能产生有顺序的 append 操作，只能进行 insert 操作，导致读取整个 <code>B+</code> 树节点到内存，插入记录后将整个节点写回磁盘，当记录占用空间很大的时候，性能很差。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>获取系统当前时间作为唯一 ID。</p>
<ul>
<li>缺点
<ul>
<li>高并发时，1 ms内可能有多个相同的 ID。</li>
<li>信息不安全</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Twitter 的 <code>snowflake</code>（雪花算法）：Twitter 开源的分布式 id 生成算法，64 位的 long 型的 id，分为 4 部分</p>
<p><img alt="snowflake 算法" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a62edd50cc104558917c27de40e0151d~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<ul>
<li>
<p>1 bit：不用，统一为 0</p>
</li>
<li>
<p>41 bits：毫秒时间戳，可以表示 69 年的时间。</p>
</li>
<li>
<p>10 bits：5 bits 代表机房 id，5 个 bits 代表机器 id。最多代表 32 个机房，每个机房最多代表 32 台机器。</p>
</li>
<li>
<p>12 bits：同一毫秒内的 id，最多 4096 个不同 id，自增模式</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>
<p>毫秒数在高位，自增序列在低位，整个ID都是趋势递增的。</p>
</li>
<li>
<p>不依赖数据库等第三方系统，以服务的方式部署，稳定性更高，生成ID的性能也是非常高的。</p>
</li>
<li>
<p>可以根据自身业务特性分配bit位，非常灵活。</p>
</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>强依赖机器时钟，如果机器上时钟回拨（可以搜索 <strong>2017 年闰秒 7:59:60</strong>），会导致发号重复或者服务会处于不可用状态。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>百度的 <code>UIDGenerator</code> 算法。</p>
<ul>
<li>基于 Snowflake 的优化算法。</li>
<li>借用未来时间和双 Buffer 来解决时间回拨与生成性能等问题，同时结合 MySQL 进行 ID 分配。</li>
</ul>
<p><img alt="UIDGenerator 算法" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf4b28af7d3a4646b88fa6ffd2bcf951~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
</li>
<li>
<p>美团的 <code>Leaf-Snowflake</code> 算法。</p>
<ul>
<li>为什么叫 Leaf（叶子）：来自数学家莱布尼茨的一句话：“世界上没有两片相同的树叶”，也就是说这个算法生成的 ID 是唯一的。</li>
</ul>
<p><img alt="图片来源于美团" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e3803f0b3c8b4370954eee8bb96e1f85~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<ul>
<li>获取 id 是通过代理服务访问数据库获取一批 id（号段）。</li>
<li>双缓冲：当前一批的 id 使用 10%时，再访问数据库获取新的一批 id 缓存起来，等上批的 id 用完后直接用。</li>
<li>优点：
<ul>
<li>Leaf服务可以很方便的线性扩展，性能完全能够支撑大多数业务场景。</li>
<li>ID号码是趋势递增的8byte的64位数字，满足上述数据库存储的主键要求。</li>
<li>容灾性高：Leaf服务内部有号段缓存，即使DB宕机，短时间内Leaf仍能正常对外提供服务。</li>
<li>可以自定义max_id的大小，非常方便业务从原有的ID方式上迁移过来。</li>
<li>即使DB宕机，Leaf仍能持续发号一段时间。</li>
<li>偶尔的网络抖动不会影响下个号段的更新。</li>
</ul>
</li>
<li>缺点：
<ul>
<li>ID号码不够随机，能够泄露发号数量的信息，不太安全。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 data-id="heading-41">四、分布式事务的坑</h1>
<h3 data-id="heading-42">怎么理解事务？</h3>
<ul>
<li>
<p>事务可以简单理解为要么这件事情全部做完，要么这件事情一点都没做，跟没发生一样。</p>
</li>
<li>
<p>在分布式的世界中，存在着各个服务之间相互调用，链路可能很长，如果有任何一方执行出错，则需要回滚涉及到的其他服务的相关操作。比如订单服务下单成功，然后调用营销中心发券接口发了一张代金券，但是微信支付扣款失败，则需要退回发的那张券，且需要将订单状态改为异常订单。</p>
</li>
</ul>
<blockquote>
<p><code>坑</code>：如何保证分布式中的事务正确执行，是个大难题。</p>
</blockquote>
<h3 data-id="heading-43">分布式事务的几种主要方式</h3>
<ul>
<li>XA 方案（两阶段提交方案）</li>
<li>TCC 方案（try、confirm、cancel）</li>
<li>SAGA 方案</li>
<li>可靠消息最终一致性方案</li>
<li>最大努力通知方案</li>
</ul>
<h3 data-id="heading-44">XA 方案原理</h3>
<p><img alt="XA 方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7af1e5e568d442aa299b1c231d2405c~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<ul>
<li>事务管理器负责协调多个数据库的事务，先问问各个数据库准备好了吗？如果准备好了，则在数据库执行操作，如果任一数据库没有准备，则回滚事务。</li>
<li>适合单体应用，不适合微服务架构。因为每个服务只能访问自己的数据库，不允许交叉访问其他微服务的数据库。</li>
</ul>
<h3 data-id="heading-45">TCC 方案</h3>
<ul>
<li>Try 阶段：对各个服务的资源做检测以及对资源进行锁定或者预留。</li>
<li>Confirm 阶段：各个服务中执行实际的操作。</li>
<li>Cancel 阶段：如果任何一个服务的业务方法执行出错，需要将之前操作成功的步骤进行回滚。</li>
</ul>
<p>应用场景：</p>
<ul>
<li>跟支付、交易打交道，必须保证资金正确的场景。</li>
<li>对于一致性要求高。</li>
</ul>
<p>缺点：</p>
<ul>
<li>但因为要写很多补偿逻辑的代码，且不易维护，所以其他场景建议不要这么做。</li>
</ul>
<h3 data-id="heading-46">Sega 方案</h3>
<p>基本原理：</p>
<ul>
<li>业务流程中的每个步骤若有一个失败了，则补偿前面操作成功的步骤。</li>
</ul>
<p>适用场景：</p>
<ul>
<li>业务流程长、业务流程多。</li>
<li>参与者包含其他公司或遗留系统服务。</li>
</ul>
<p>优势：</p>
<ul>
<li>第一个阶段提交本地事务、无锁、高性能。</li>
<li>参与者可异步执行、高吞吐。</li>
<li>补偿服务易于实现。</li>
</ul>
<p>缺点：</p>
<ul>
<li>不保证事务的隔离性。</li>
</ul>
<h3 data-id="heading-47">可靠消息一致性方案</h3>
<p><img alt="可靠消息一致性方案" class="lazyload" data-src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/947ba79f14f34f09927df303ce93ffa5~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600"></p>
<p>基本原理：</p>
<ul>
<li>利用消息中间件 <code>RocketMQ</code> 来实现消息事务。</li>
<li>第一步：A 系统发送一个消息到 MQ，MQ将消息状态标记为 <code>prepared</code>（预备状态，半消息），该消息无法被订阅。</li>
<li>第二步：MQ 响应 A 系统，告诉 A 系统已经接收到消息了。</li>
<li>第三步：A 系统执行本地事务。</li>
<li>第四步：若 A 系统执行本地事务成功，将 <code>prepared</code> 消息改为 <code>commit</code>（提交事务消息），B 系统就可以订阅到消息了。</li>
<li>第五步：MQ 也会定时轮询所有 <code>prepared</code>的消息，回调 A 系统，让 A 系统告诉 MQ 本地事务处理得怎么样了，是继续等待还是回滚。</li>
<li>第六步：A 系统检查本地事务的执行结果。</li>
<li>第七步：若 A 系统执行本地事务失败，则 MQ 收到 <code>Rollback</code> 信号，丢弃消息。若执行本地事务成功，则 MQ 收到 <code>Commit</code> 信号。</li>
<li>B 系统收到消息后，开始执行本地事务，如果执行失败，则自动不断重试直到成功。或 B 系统采取回滚的方式，同时要通过其他方式通知 A 系统也进行回滚。</li>
<li>B 系统需要保证幂等性。</li>
</ul>
<h3 data-id="heading-48">最大努力通知方案</h3>
<p>基本原理：</p>
<ul>
<li>系统 A 本地事务执行完之后，发送消息到 MQ。</li>
<li>MQ 将消息持久化。</li>
<li>系统 B 如果执行本地事务失败，则<code>最大努力服务</code>会定时尝试重新调用系统 B，尽自己最大的努力让系统 B 重试，重试多次后，还是不行就只能放弃了。转到开发人员去排查以及后续人工补偿。</li>
</ul>
<h3 data-id="heading-49">几种方案如何选择</h3>
<ul>
<li>跟支付、交易打交道，优先 TCC。</li>
<li>大型系统，但要求不那么严格，考虑 消息事务或 SAGA 方案。</li>
<li>单体应用，建议 XA 两阶段提交就可以了。</li>
<li>最大努力通知方案建议都加上，毕竟不可能一出问题就交给开发排查，先重试几次看能不能成功。</li>
</ul>
<h2 data-id="heading-50">写在最后</h2>
<p>分布式还有很多坑，这篇只是一个小小的总结，从这些坑中，我们也知道分布式有它的优势也有它的劣势，那到底该不该用分布式，完全取决于业务、时间、成本以及开发团队的综合实力。后续我会继续分享分布式中的一些底层原理，当然也少不了分享一些避坑指南。</p>
<p>参考资料：<br>
美团的 Leaf-Snowflake 算法。<br>
百度的 UIDGenerator 算法。<br>
Advanced-java</p>
<blockquote>
<p>你好，我是<code>悟空哥</code>，<strong>「7年项目开发经验，全栈工程师，开发组长，超喜欢图解编程底层原理」</strong>。</p>
</blockquote>
<p>我还<code>手写了 2 个小程序</code>，<code>Java 刷题小程序</code>，<code>PMP 刷题小程序</code>，点击我的公众号菜单打开！<br>
另外有 111 本架构师资料以及 1000 道 Java 面试题，都整理成了PDF。<br>
可以关注公众号 <strong>「悟空聊架构」</strong> 回复 <code>悟空</code> 领取优质资料。</p>
<p><strong>「转发->在看->点赞->收藏->评论！！！」</strong> 是对我最大的支持！</p>
<p><strong>《Java并发必知必会》系列：</strong></p>
<p><a href="https://juejin.im/post/6861885337568804871" target="_blank">1.反制面试官 | 14张原理图 | 再也不怕被问 volatile!</a></p>
<p><a href="https://juejin.im/post/6863799243182702599" target="_blank">2.程序员深夜惨遭老婆鄙视，原因竟是CAS原理太简单？</a></p>
<p><a href="https://juejin.im/post/6864945088721027079" target="_blank">3.用积木讲解ABA原理 | 老婆居然又听懂了！</a></p>
<p><a href="https://juejin.im/post/6866444584688451591" target="_blank">4.全网最细 |  21张图带你领略集合的线程不安全</a></p>
<p><a href="https://juejin.im/post/6867922895536914446" target="_blank">5.5000字 | 24张图带你彻底理解Java中的21种锁</a></p>
<p><a href="https://juejin.im/post/6870298844425371655" target="_blank">6.干货 | 一口气说出18种队列(Queue)，面试稳了</a></p>
<p><a href="https://juejin.im/post/6872367966512644103" target="_blank">🏆 技术专题第五期 | 聊聊分布式的那些事......</a></p>
<p><a href="https://juejin.im/post/6888208307924762638" target="_blank">🏆 技术专题第五期 | 聊聊分布式的那些事......</a></p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div></div></article> <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div> <!----> <!----> <div class="article-suspended-panel article-suspended-panel" data-v-19356a56 data-v-064b8453><div badge="69" class="like-btn panel-btn like-adjust with-badge" data-v-19356a56></div> <div badge="18" class="comment-btn panel-btn comment-adjust with-badge" data-v-19356a56></div> <div class="collect-btn panel-btn" data-v-19356a56><!----></div> <div class="share-title" data-v-19356a56>分享</div> <div class="weibo-btn share-btn panel-btn" data-v-19356a56></div> <div class="qq-btn share-btn panel-btn" data-v-19356a56></div> <div class="wechat-btn share-btn panel-btn" data-v-19356a56><img src="" class="wechat-qr-code-img shadow" style="display:none;" data-v-19356a56></div></div></div></main></div> <!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){return {layout:"default",data:[{}],fetch:[],error:b,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:c,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:d},followed:{pageSize:g,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:d},recommendPin:{list:[],after:e,loading:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:j,name:j,title:"推荐 ",id:j},{type:k,name:k,title:"热门 ",id:k},{type:l,name:l,title:"关注 ",id:l},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:m}},search:{list:[],linkList:[],query:e,period:n,type:n,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:o,category:n},hotList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:m,category:j,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},timelineList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:a,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,loading:a,hasMore:a,skeleton:a,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:a,loading:a,hasMore:c,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:c,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:c,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:o,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:c,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:c,hasMore:a,cursor:f,type:"created",loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:c,hasMore:a,loading:a,type:"bought",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},courseList:{list:[],hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:c,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}},eventList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FRESET"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fuser\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:d,msgSubMap:{"1":d,"2":d,"3":d,"4":d}},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fsystem\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{column:{id:q},entry:{id:q,screenshot:void 0,liked:a,article_id:q,article_info:{article_id:q,user_id:"3773179639893229",category_id:"6809637769959178254",tag_ids:[6809641135154135000],visible_level:d,link_url:e,cover_image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F29308d5da0d04b98abe30d510df9f94a~tplv-k3u1fbpfcp-zoom-1.image",is_gfw:d,title:"这三年被分布式坑惨了，曝光十大坑 | 🏆 技术专题第五期征文",brief_content:"我们都在讨论分布式，特别是面试的时候，不管是招初级软件工程师还是高级，都会要求懂分布式，甚至要求用过。传得沸沸扬扬的分布式到底是什么东东，有什么优势？ 看过火影的同学肯定知道漩涡鸣人的招牌忍术：多重影分身之术。 这个术有一个特别厉害的地方，过程和心得：多个分身的感受和经历都是相…",is_english:d,is_original:h,user_index:d,original_type:d,original_author:e,content:e,ctime:"1600883054",mtime:"1603956828",rtime:"1600920220",draft_id:"6875738877009592333",view_count:2186,collect_count:d,digg_count:69,comment_count:18,hot_index:196,is_hot:d,rank_index:.00439858,status:2,verify_status:h,audit_status:2,mark_content:"\n本篇主要内容如下：\n\n![主要内容](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F01ed0519820547948ebc156509922ca6~tplv-k3u1fbpfcp-zoom-1.image)\n\n\n\n# 前言\n\n我们都在讨论分布式，特别是面试的时候，不管是招初级软件工程师还是高级，都会要求懂分布式，甚至要求用过。传得沸沸扬扬的分布式到底是什么东东，有什么优势？\n\n### 借用火影忍术\n\n![风遁 螺旋手里剑](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F1d167cd4524c4af09343dc8069ee5ce1~tplv-k3u1fbpfcp-zoom-1.image)\n\n看过`火影`的同学肯定知道`漩涡鸣人`的招牌忍术：`多重影分身之术`。\n\n- 这个术有一个特别厉害的地方，`过程和心得`：多个分身的感受和经历都是相通的。比如 A 分身去找卡卡西（鸣人的老师）请教问题，那么其他分身也会知道 A 分身问的什么问题。\n- `漩涡鸣人`有另外一个超级厉害的忍术，需要由几个影分身完成：`风遁·螺旋手里剑`。这个忍术是靠三个鸣人一起协作完成的。\n\n这两个忍术和分布式有什么关系？\n\n- 分布在不同地方的系统或服务，是彼此相互关联的。\n\n- 分布式系统是分工合作的。\n\n案例：\n\n- 比如 Redis 的`哨兵机制`，可以知道集群环境下哪台 `Redis` 节点挂了。\n- Kafka的 `Leader 选举机制`，如果某个节点挂了，会从 `follower` 中重新选举一个 leader 出来。（leader 作为写数据的入口，follower 作为读的入口）\n\n那`多重影分身之术`有什么缺点？\n\n- 会消耗大量的查克拉。分布式系统同样具有这个问题，需要几倍的资源来支持。\n\n### 对分布式的通俗理解\n\n- 是一种工作方式\n- 若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统\n- 将不同的业务分布在不同的地方\n\n### 优势可以从两方面考虑：一个是宏观，一个是微观。\n\n- 宏观层面：多个功能模块糅合在一起的系统进行服务拆分，来解耦服务间的调用。\n- 微观层面：将模块提供的服务分布到不同的机器或容器里，来扩大服务力度。\n\n### 任何事物有阴必有阳，那分布式又会带来哪些问题呢？\n\n- 需要更多优质人才懂分布式，人力成本增加\n- 架构设计变得异常复杂，学习成本高\n- 运维部署和维护成本显著增加\n- 多服务间链路变长，开发排查问题难度加大\n- 环境高可靠性问题\n- 数据幂等性问题\n- 数据的顺序问题\n- 等等\n\n讲到`分布式`不得不知道 `CAP` 定理和 `Base` 理论，这里给不知道的同学做一个扫盲。\n\n### CAP 定理\n\n在理论计算机科学中，CAP 定理指出对于一个分布式计算系统来说，不可能通是满足以下三点：\n\n- **一致性（Consistency）** \n  - 所有节点访问同一份最新的数据副本。\n- **可用性（Availability）** \n  - 每次请求都能获取到非错的响应，但不保证获取的数据为最新数据\n- **分区容错性（Partition tolerance）** \n  - 不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择）\n\n### BASE 理论\n\n`BASE` 是 `Basically Available`（基本可用）、`Soft state`（软状态）和 `Eventually consistent`（最终一致性）三个短语的缩写。`BASE` 理论是对 `CAP ` 中 `AP` 的一个扩展，通过牺牲强一致性来获得可用性，当出现故障允许部分不可用但要保证核心功能可用，允许数据在一段时间内是不一致的，但最终达到一致状态。满足 `BASE` 理论的事务，我们称之为`柔性事务`。\n\n- **基本可用 ：** 分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。如电商网址交易付款出现问题来，商品依然可以正常浏览。\n- **软状态：** 由于不要求强一致性，所以BASE允许系统中存在中间状态（也叫软状态），这个状态不影响系统可用性，如订单中的“支付中”、“数据同步中”等状态，待数据最终一致后状态改为“成功”状态。\n- **最终一致性：** 最终一致是指的经过一段时间后，所有节点数据都将会达到一致。如订单的“支付中”状态，最终会变为“支付成功”或者“支付失败”，使订单状态与实际交易结果达成一致，但需要一定时间的延迟、等待。\n\n# 一、分布式消息队列的坑\n\n### 消息队列如何做分布式？\n\n将消息队列里面的消息分摊到多个节点（指某台机器或容器）上，所有节点的消息队列之和就包含了所有消息。\n\n## 1. 消息队列的坑之非幂等\n\n### （1）幂等性概念\n\n所谓幂等性就是无论多少次操作和第一次的操作结果一样。如果消息被多次消费，很有可能造成数据的不一致。而如果消息不可避免地被消费多次，如果我们开发人员能通过技术手段保证数据的前后一致性，那也是可以接受的，这让我想起了 Java 并发编程中的 ABA 问题，如果出现了 [ABA 问题]([用积木讲解 ABA 原理 | 老婆居然又听懂了！](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6864945088721027079))，若能保证所有数据的前后一致性也能接受。\n\n### （2）场景分析\n\n`RabbitMQ`、`RocketMQ`、`Kafka` 消息队列中间件都有可能出现消息重复消费问题。这种问题并不是 MQ 自己保证的，而是需要开发人员来保证。\n\n这几款消息队列中间都是是全球最牛的分布式消息队列，那肯定考虑到了消息的幂等性。我们以 Kafka 为例，看看 Kafka 是怎么保证消息队列的幂等性。\n\nKafka 有一个 ` 偏移量 ` 的概念，代表着消息的序号，每条消息写到消息队列都会有一个偏移量，消费者消费了数据之后，每过一段固定的时间，就会把消费过的消息的偏移量提交一下，表示已经消费过了，下次消费就从偏移量后面开始消费。\n\n\u003E  `坑：`当消费完消息后，还没来得及提交偏移量，系统就被关机了，那么未提交偏移量的消息则会再次被消费。\n\n如下图所示，队列中的数据 A、B、C，对应的偏移量分别为 100、101、102，都被消费者消费了，但是只有数据 A 的偏移量 100 提交成功，另外 2 个偏移量因系统重启而导致未及时提交。\n\n![系统重启，偏移量未提交](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F678db990060545389720a20b6de58a78~tplv-k3u1fbpfcp-zoom-1.image)\n\n重启后，消费者又是拿偏移量 100 以后的数据，从偏移量 101 开始拿消息。所以数据 B 和数据 C 被重复消息。\n\n如下图所示：\n\n![重启后，重复消费消息](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fefb9c03422bd446aafe3d15a301058b2~tplv-k3u1fbpfcp-zoom-1.image)\n\n### （3）避坑指南\n\n- 微信支付结果通知场景\n  - 微信官方文档上提到微信支付通知结果可能会推送多次，需要开发者自行保证幂等性。第一次我们可以直接修改订单状态（如支付中 -\u003E 支付成功），第二次就根据订单状态来判断，如果不是支付中，则不进行订单处理逻辑。\n- 插入数据库场景\n  - 每次插入数据时，先检查下数据库中是否有这条数据的主键 id，如果有，则进行更新操作。\n- 写 Redis 场景\n  - Redis 的 `Set` 操作天然幂等性，所以不用考虑 Redis 写数据的问题。\n- 其他场景方案\n  - 生产者发送每条数据时，增加一个全局唯一 id，类似订单 id。每次消费时，先去 Redis 查下是否有这个 id，如果没有，则进行正常处理消息，且将 id 存到 Redis。如果查到有这个 id，说明之前消费过，则不要进行重复处理这条消息。\n  - 不同业务场景，可能会有不同的幂等性方案，大家选择合适的即可，上面的几种方案只是提供常见的解决思路。\n\n## 2. 消息队列的坑之消息丢失\n\n\u003E `坑:`消息丢失会带来什么问题？如果是订单下单、支付结果通知、扣费相关的消息丢失，则可能造成财务损失，如果量很大，就会给甲方带来巨大损失。\n\n那消息队列是否能保证消息不丢失呢？答案：否。主要有三种场景会导致消息丢失。\n\n![消息队列之消息丢失](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fc444b2838f8d4d92ad3c56ecb46ed675~tplv-k3u1fbpfcp-zoom-1.image)\n\n### （1）生产者存放消息的过程中丢失消息\n\n![生产者丢失消息](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F80bf3723352843cbbc82133d8ff0e130~tplv-k3u1fbpfcp-zoom-1.image)\n\n#### 解决方案\n\n- 事务机制（不推荐，异步方式）\n\n对于 RabbitMQ 来说，生产者发送数据之前开启 RabbitMQ 的**事务机制**`channel.txselect` ，如果消息没有进队列，则生产者受到异常报错，并进行回滚 `channel.txRollback`，然后重试发送消息；如果收到了消息，则可以提交事务 `channel.txCommit`。但这是一个同步的操作，会影响性能。\n\n- confirm 机制（推荐，异步方式）\n\n我们可以采用另外一种模式： `confirm` 模式来解决同步机制的性能问题。每次生产者发送的消息都会分配一个唯一的 id，如果写入到了 RabbitMQ 队列中，则 RabbitMQ 会回传一个 `ack` 消息，说明这个消息接收成功。如果 RabbitMQ 没能处理这个消息，则回调 `nack` 接口。说明需要重试发送消息。\n\n也可以自定义超时时间 + 消息 id 来实现超时等待后重试机制。但可能出现的问题是调用 ack 接口时失败了，所以会出现消息被发送两次的问题，这个时候就需要保证消费者消费消息的幂等性。\n\n#### ` 事务模式 ` 和 `confirm` 模式的区别：\n\n- 事务机制是同步的，提交事务后悔被**阻塞**直到提交事务完成后。\n- confirm 模式异步接收通知，但可能**接收不到通知**。需要考虑接收不到通知的场景。\n\n### （2）消息队列丢失消息\n\n![消息队列丢失消息](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F496ffed09a34431991bab1de7054d8a9~tplv-k3u1fbpfcp-zoom-1.image)\n\n消息队列的消息可以放到内存中，或将内存中的消息转到硬盘（比如数据库）中，一般都是内存和硬盘中都存有消息。如果只是放在内存中，那么当机器重启了，消息就全部丢失了。如果是硬盘中，则可能存在一种极端情况，就是将内存中的数据转换到硬盘的期间中，消息队列出问题了，未能将消息持久化到硬盘。\n\n**解决方案**\n\n- 创建 `Queue` 的时候将其设置为持久化。这个地方没搞懂，欢迎探讨解答。\n- 发送消息的时候将消息的 `deliveryMode` 设置为 2 。\n- 开启生产者 `confirm` 模式，可以重试发送消息。\n\n### （3）消费者丢失消息\n\n![消费者丢失消息](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F2ef429275fe84923974035a5f88dbc7a~tplv-k3u1fbpfcp-zoom-1.image)\n\n消费者刚拿到数据，还没开始处理消息，结果进程因为异常退出了，消费者没有机会再次拿到消息。\n\n**解决方案** \n\n- 关闭 RabbitMQ 的自动 `ack`，每次生产者将消息写入消息队列后，就自动回传一个 `ack` 给生产者。\n- 消费者处理完消息再主动 `ack`，告诉消息队列我处理完了。\n\n**问题：** 那这种主动 `ack` 有什么漏洞了？如果 主动 `ack` 的时候挂了，怎么办？\n\n则可能会被再次消费，这个时候就需要幂等处理了。\n\n**问题：** 如果这条消息一直被重复消费怎么办？\n\n则需要有加上重试次数的监测，如果超过一定次数则将消息丢失，记录到异常表或发送异常通知给值班人员。\n\n### （4）RabbitMQ 消息丢失总结\n\n![RabbitMQ 丢失消息的处理方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F756811711f934472a9edbc48eb603707~tplv-k3u1fbpfcp-zoom-1.image)\n\n###  （5）Kafka 消息丢失\n\n**场景：**`Kafka` 的某个 broker（节点）宕机了，重新选举 leader （写入的节点）。如果 leader 挂了，follower 还有些数据未同步完，则 follower 成为 leader 后，消息队列会丢失一部分数据。\n\n**解决方案**\n\n- 给 topic 设置 `replication.factor` 参数，值必须大于 1，要求每个 partition 必须有至少 2 个副本。\n- 给 kafka 服务端设置 `min.insyc.replicas` 必须大于 1，表示一个 leader 至少一个 follower 还跟自己保持联系。\n\n## 3. 消息队列的坑之消息乱序\n\n\u003E `坑:` 用户先下单成功，然后取消订单，如果顺序颠倒，则最后数据库里面会有一条下单成功的订单。\n\n**RabbitMQ 场景：** \n\n- 生产者向消息队列按照顺序发送了 2 条消息，消息1：增加数据 A，消息2：删除数据 A。\n- 期望结果：数据 A 被删除。\n- 但是如果有两个消费者，消费顺序是：消息2、消息 1。则最后结果是增加了数据 A。\n\n![RabbitMQ消息乱序场景](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fe4a83f8dfeb542dfa47295d121648604~tplv-k3u1fbpfcp-zoom-1.image)\n\n![RabbitMQ 消息乱序场景](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fc3b00611a8e74f1d9696996c53ffd2cb~tplv-k3u1fbpfcp-zoom-1.image)\n\n**RabbitMQ 解决方案：** \n\n- 将 Queue 进行拆分，创建多个内存 Queue，消息 1 和 消息 2 进入同一个 Queue。\n- 创建多个消费者，每一个消费者对应一个 Queue。\n\n![RabbitMQ 解决方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F54c37e64198f4cb98777b155955d3377~tplv-k3u1fbpfcp-zoom-1.image)\n\n**Kafka 场景：** \n\n- 创建了 topic，有 3 个 partition。\n- 创建一条订单记录，订单 id 作为 key，订单相关的消息都丢到同一个 partition 中，同一个生产者创建的消息，顺序是正确的。\n- 为了快速消费消息，会创建多个消费者去处理消息，而为了提高效率，每个消费者可能会创建多个线程来并行的去拿消息及处理消息，处理消息的顺序可能就乱序了。\n\n![Kafka 消息丢失场景](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fb56e9cbaad484eadb20f1e288f1bb535~tplv-k3u1fbpfcp-zoom-1.image)\n\n**Kafka 解决方案：** \n\n- 解决方案和 RabbitMQ 类似，利用多个 内存 Queue，每个线程消费 1个 Queue。\n- 具有相同 key 的消息 进同一个 Queue。\n\n![Kafka 消息乱序解决方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fcf58802508854d56829a7ecdcb158073~tplv-k3u1fbpfcp-zoom-1.image)\n\n## 4. 消息队列的坑之消息积压\n\n消息积压：消息队列里面有很多消息来不及消费。\n\n**场景 1：** 消费端出了问题，比如消费者都挂了，没有消费者来消费了，导致消息在队列里面不断积压。\n\n**场景 2：** 消费端出了问题，比如消费者消费的速度太慢了，导致消息不断积压。\n\n\u003E 坑：比如线上正在做订单活动，下单全部走消息队列，如果消息不断积压，订单都没有下单成功，那么将会损失很多交易。\n\n![消息队列之消息积压](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9c4cf34f137843e1a5533a4395e7b9f1~tplv-k3u1fbpfcp-zoom-1.image)\n\n解决方案：**解铃还须系铃人** \n\n- 修复代码层面消费者的问题，确保后续消费速度恢复或尽可能加快消费的速度。\n- 停掉现有的消费者。\n- 临时建立好原先 5 倍的 Queue 数量。\n- 临时建立好原先 5 倍数量的 消费者。\n- 将堆积的消息全部转入临时的 Queue，消费者来消费这些 Queue。\n\n![消息积压解决方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fa3596bdfff3f4a1697330e49bb7e0fa4~tplv-k3u1fbpfcp-zoom-1.image)\n\n## 5. 消息队列的坑之消息过期失效\n\n\u003E `坑：`RabbitMQ 可以设置过期时间，如果消息超过一定的时间还没有被消费，则会被 RabbitMQ 给清理掉。消息就丢失了。\n\n![消息过期失效](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fd455c4fbf2c84cf681659dfc02a40e05~tplv-k3u1fbpfcp-zoom-1.image)\n\n解决方案：\n\n- 准备好批量重导的程序\n- 手动将消息闲时批量重导\n\n![消息过期失效解决方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F96765f014404428c8965a70e8b8fd99a~tplv-k3u1fbpfcp-zoom-1.image)\n\n## 6. 消息队列的坑之队列写满\n\n\u003E `坑：`当消息队列因消息积压导致的队列快写满，所以不能接收更多的消息了。生产者生产的消息将会被丢弃。\n\n解决方案：\n\n- 判断哪些是无用的消息，RabbitMQ 可以进行 `Purge Message` 操作。\n- 如果是有用的消息，则需要将消息快速消费，将消息里面的内容转存到数据库。\n- 准备好程序将转存在数据库中的消息再次重导到消息队列。\n- 闲时重导消息到消息队列。\n\n# 二、分布式缓存的坑\n\n在高频访问数据库的场景中，我们会在业务层和数据层之间加入一套缓存机制，来分担数据库的访问压力，毕竟访问磁盘 I\u002FO 的速度是很慢的。比如利用缓存来查数据，可能5ms就能搞定，而去查数据库可能需要 50 ms，差了一个数量级。而在高并发的情况下，数据库还有可能对数据进行加锁，导致访问数据库的速度更慢。\n\n分布式缓存我们用的最多的就是 Redis了，它可以提供分布式缓存服务。\n\n## 1. Redis 数据丢失的坑\n\n### 哨兵机制\n\nRedis 可以实现利用`哨兵机制`实现集群的高可用。那什么十哨兵机制呢？\n\n- 英文名：`sentinel`，中文名：`哨兵`。\n- 集群监控：负责主副进程的正常工作。\n- 消息通知：负责将故障信息报警给运维人员。\n- 故障转移：负责将主节点转移到备用节点上。\n- 配置中心：通知客户端更新主节点地址。\n- 分布式：有多个哨兵分布在每个主备节点上，互相协同工作。\n- 分布式选举：需要大部分哨兵都同意，才能进行主备切换。\n- 高可用：即使部分哨兵节点宕机了，哨兵集群还是能正常工作。\n\n\u003E `坑：` 当主节点发生故障时，需要进行主备切换，可能会导致数据丢失。\n\n### 异步复制数据导致的数据丢失\n\n主节点异步同步数据给备用节点的过程中，主节点宕机了，导致有部分数据未同步到备用节点。而这个从节点又被选举为主节点，这个时候就有部分数据丢失了。\n\n### 脑裂导致的数据丢失\n\n主节点所在机器脱离了集群网络，实际上自身还是运行着的。但哨兵选举出了备用节点作为主节点，这个时候就有两个主节点都在运行，相当于两个大脑在指挥这个集群干活，但到底听谁的呢？这个就是脑裂。\n\n那怎么脑裂怎么会导致数据丢失呢？如果发生脑裂后，客户端还没来得及切换到新的主节点，连的还是第一个主节点，那么有些数据还是写入到了第一个主节点里面，新的主节点没有这些数据。那等到第一个主节点恢复后，会被作为备用节点连到集群环境，而且自身数据会被清空，重新从新的主节点复制数据。而新的主节点因没有客户端之前写入的数据，所以导致数据丢失了一部分。\n\n### 避坑指南\n\n- 配置 min-slaves-to-write 1，表示至少有一个备用节点。\n- 配置 min-slaves-max-lag 10，表示数据复制和同步的延迟不能超过 10 秒。最多丢失 10 秒的数据\n\n注意：`缓存雪崩`、`缓存穿透`、`缓存击穿`并不是分布式所独有的，单机的时候也会出现。所以不在分布式的坑之列。\n\n# 三、分库分表的坑\n\n## 1.分库分表的坑之扩容\n\n#### 分库、分表、垂直拆分和水平拆分\n\n- **分库：** 因一个数据库支持的最高并发访问数是有限的，可以将一个数据库的数据拆分到多个库中，来增加最高并发访问数。\n\n- **分表：** 因一张表的数据量太大，用索引来查询数据都搞不定了，所以可以将一张表的数据拆分到多张表，查询时，只用查拆分后的某一张表，SQL 语句的查询性能得到提升。\n\n- 分库分表优势：分库分表后，承受的并发增加了多倍；磁盘使用率大大降低；单表数据量减少，SQL 执行效率明显提升。\n\n- **水平拆分：** 把一个表的数据拆分到多个数据库，每个数据库中的表结构不变。用多个库抗更高的并发。比如订单表每个月有500万条数据累计，每个月都可以进行水平拆分，将上个月的数据放到另外一个数据库。\n- **垂直拆分：** 把一个有很多字段的表，拆分成多张表到同一个库或多个库上面。高频访问字段放到一张表，低频访问的字段放到另外一张表。利用数据库缓存来缓存高频访问的行数据。比如将一张很多字段的订单表拆分成几张表分别存不同的字段（可以有冗余字段）。\n- **分库、分表的方式：** \n  - 根据租户来分库、分表。\n  - 利用时间范围来分库、分表。\n  - 利用 ID 取模来分库、分表。\n\n\u003E `坑：`分库分表是一个运维层面需要做的事情，有时会采取凌晨宕机开始升级。可能熬夜到天亮，结果升级失败，则需要回滚，其实对技术团队都是一种煎熬。\n\n#### 怎么做成自动的来节省分库分表的时间？\n\n- 双写迁移方案：迁移时，新数据的增删改操作在新库和老库都做一遍。\n- 使用分库分表工具 Sharding-jdbc  来完成分库分表的累活。\n- 使用程序来对比两个库的数据是否一致，直到数据一致。\n\n\u003E `坑:` 分库分表看似光鲜亮丽，但分库分表会引入什么新的问题呢？\n\n#### 垂直拆分带来的问题\n\n- 依然存在单表数据量过大的问题。\n- 部分表无法关联查询，只能通过接口聚合方式解决，提升了开发的复杂度。\n- 分布式事处理复杂。\n\n#### 水平拆分带来的问题\n\n- 跨库的关联查询性能差。\n- 数据多次扩容和维护量大。\n- 跨分片的事务一致性难以保证。\n\n## 2.分库分表的坑之唯一 ID\n\n### 为什么分库分表需要唯一 ID\n\n- 如果要做分库分表，则必须得考虑表主键 ID 是全局唯一的，比如有一张订单表，被分到 A 库和 B 库。如果 两张订单表都是从 1 开始递增，那查询订单数据时就错乱了，很多订单 ID 都是重复的，而这些订单其实不是同一个订单。\n- 分库的一个期望结果就是将访问数据的次数分摊到其他库，有些场景是需要均匀分摊的，那么数据插入到多个数据库的时候就需要交替生成唯一的 ID 来保证请求均匀分摊到所有数据库。\n\n\u003E `坑:` 唯一 ID 的生成方式有 n 种，各有各的用途，别用错了。\n\n### 生成唯一 ID 的原则\n\n- 全局唯一性\n- 趋势递增\n- 单调递增\n- 信息安全\n\n### 生成唯一 ID 的几种方式\n\n- 数据库自增 ID。每个数据库每增加一条记录，自己的 ID 自增 1。\n\n  - 缺点\n    - 多个库的 ID 可能重复，这个方案可以直接否掉了，不适合分库分表后的 ID 生成。\n    - 信息不安全\n\n- 适用 `UUID` 唯一 ID。\n\n  - 缺点 \n    - UUID 太长、占用空间大。\n    - 不具有有序性，作为主键时，在写入数据时，不能产生有顺序的 append 操作，只能进行 insert 操作，导致读取整个 `B+` 树节点到内存，插入记录后将整个节点写回磁盘，当记录占用空间很大的时候，性能很差。\n\n- 获取系统当前时间作为唯一 ID。\n\n  - 缺点\n    - 高并发时，1 ms内可能有多个相同的 ID。\n    - 信息不安全\n\n- Twitter 的 `snowflake`（雪花算法）：Twitter 开源的分布式 id 生成算法，64 位的 long 型的 id，分为 4 部分\n\n  ![snowflake 算法](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fa62edd50cc104558917c27de40e0151d~tplv-k3u1fbpfcp-zoom-1.image)\n\n  - 1 bit：不用，统一为 0\n\n  - 41 bits：毫秒时间戳，可以表示 69 年的时间。\n\n  - 10 bits：5 bits 代表机房 id，5 个 bits 代表机器 id。最多代表 32 个机房，每个机房最多代表 32 台机器。\n\n  - 12 bits：同一毫秒内的 id，最多 4096 个不同 id，自增模式\n\n  - 优点：\n\n    - 毫秒数在高位，自增序列在低位，整个ID都是趋势递增的。\n\n    - 不依赖数据库等第三方系统，以服务的方式部署，稳定性更高，生成ID的性能也是非常高的。\n\n    - 可以根据自身业务特性分配bit位，非常灵活。\n\n  - 缺点：\n\n    - 强依赖机器时钟，如果机器上时钟回拨（可以搜索 **2017 年闰秒 7:59:60**），会导致发号重复或者服务会处于不可用状态。\n\n- 百度的 `UIDGenerator` 算法。\n\n  - 基于 Snowflake 的优化算法。\n  - 借用未来时间和双 Buffer 来解决时间回拨与生成性能等问题，同时结合 MySQL 进行 ID 分配。\n\n  ![UIDGenerator 算法](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fcf4b28af7d3a4646b88fa6ffd2bcf951~tplv-k3u1fbpfcp-zoom-1.image)\n\n- 美团的 `Leaf-Snowflake` 算法。\n\n  - 为什么叫 Leaf（叶子）：来自数学家莱布尼茨的一句话：“世界上没有两片相同的树叶”，也就是说这个算法生成的 ID 是唯一的。\n\n  ![图片来源于美团](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fe3803f0b3c8b4370954eee8bb96e1f85~tplv-k3u1fbpfcp-zoom-1.image)\n\n  - 获取 id 是通过代理服务访问数据库获取一批 id（号段）。\n  - 双缓冲：当前一批的 id 使用 10%时，再访问数据库获取新的一批 id 缓存起来，等上批的 id 用完后直接用。\n  - 优点：\n    - Leaf服务可以很方便的线性扩展，性能完全能够支撑大多数业务场景。\n    - ID号码是趋势递增的8byte的64位数字，满足上述数据库存储的主键要求。\n    - 容灾性高：Leaf服务内部有号段缓存，即使DB宕机，短时间内Leaf仍能正常对外提供服务。\n    - 可以自定义max_id的大小，非常方便业务从原有的ID方式上迁移过来。\n    - 即使DB宕机，Leaf仍能持续发号一段时间。\n    - 偶尔的网络抖动不会影响下个号段的更新。\n  - 缺点：\n    - ID号码不够随机，能够泄露发号数量的信息，不太安全。\n\n\n\n# 四、分布式事务的坑\n\n###  怎么理解事务？\n\n- 事务可以简单理解为要么这件事情全部做完，要么这件事情一点都没做，跟没发生一样。\n\n- 在分布式的世界中，存在着各个服务之间相互调用，链路可能很长，如果有任何一方执行出错，则需要回滚涉及到的其他服务的相关操作。比如订单服务下单成功，然后调用营销中心发券接口发了一张代金券，但是微信支付扣款失败，则需要退回发的那张券，且需要将订单状态改为异常订单。\n\n\u003E `坑`：如何保证分布式中的事务正确执行，是个大难题。\n\n### 分布式事务的几种主要方式\n\n- XA 方案（两阶段提交方案）\n- TCC 方案（try、confirm、cancel）\n- SAGA 方案\n- 可靠消息最终一致性方案\n- 最大努力通知方案\n\n### XA 方案原理\n\n![XA 方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Ff7af1e5e568d442aa299b1c231d2405c~tplv-k3u1fbpfcp-zoom-1.image)\n\n- 事务管理器负责协调多个数据库的事务，先问问各个数据库准备好了吗？如果准备好了，则在数据库执行操作，如果任一数据库没有准备，则回滚事务。\n- 适合单体应用，不适合微服务架构。因为每个服务只能访问自己的数据库，不允许交叉访问其他微服务的数据库。\n\n### TCC 方案\n\n- Try 阶段：对各个服务的资源做检测以及对资源进行锁定或者预留。\n- Confirm 阶段：各个服务中执行实际的操作。\n- Cancel 阶段：如果任何一个服务的业务方法执行出错，需要将之前操作成功的步骤进行回滚。\n\n应用场景：\n\n- 跟支付、交易打交道，必须保证资金正确的场景。\n- 对于一致性要求高。\n\n缺点：\n\n- 但因为要写很多补偿逻辑的代码，且不易维护，所以其他场景建议不要这么做。\n\n### Sega 方案\n\n基本原理：\n\n- 业务流程中的每个步骤若有一个失败了，则补偿前面操作成功的步骤。\n\n适用场景：\n\n- 业务流程长、业务流程多。\n- 参与者包含其他公司或遗留系统服务。\n\n优势：\n\n- 第一个阶段提交本地事务、无锁、高性能。\n- 参与者可异步执行、高吞吐。\n- 补偿服务易于实现。\n\n缺点：\n\n- 不保证事务的隔离性。\n\n### 可靠消息一致性方案\n\n![可靠消息一致性方案](\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F947ba79f14f34f09927df303ce93ffa5~tplv-k3u1fbpfcp-zoom-1.image)\n\n基本原理：\n\n- 利用消息中间件 `RocketMQ` 来实现消息事务。\n- 第一步：A 系统发送一个消息到 MQ，MQ将消息状态标记为 `prepared`（预备状态，半消息），该消息无法被订阅。\n- 第二步：MQ 响应 A 系统，告诉 A 系统已经接收到消息了。\n- 第三步：A 系统执行本地事务。\n- 第四步：若 A 系统执行本地事务成功，将 `prepared` 消息改为 `commit`（提交事务消息），B 系统就可以订阅到消息了。\n- 第五步：MQ 也会定时轮询所有 `prepared`的消息，回调 A 系统，让 A 系统告诉 MQ 本地事务处理得怎么样了，是继续等待还是回滚。\n- 第六步：A 系统检查本地事务的执行结果。\n- 第七步：若 A 系统执行本地事务失败，则 MQ 收到 `Rollback` 信号，丢弃消息。若执行本地事务成功，则 MQ 收到 `Commit` 信号。\n- B 系统收到消息后，开始执行本地事务，如果执行失败，则自动不断重试直到成功。或 B 系统采取回滚的方式，同时要通过其他方式通知 A 系统也进行回滚。\n- B 系统需要保证幂等性。\n\n### 最大努力通知方案\n\n基本原理：\n\n- 系统 A 本地事务执行完之后，发送消息到 MQ。\n- MQ 将消息持久化。\n- 系统 B 如果执行本地事务失败，则`最大努力服务`会定时尝试重新调用系统 B，尽自己最大的努力让系统 B 重试，重试多次后，还是不行就只能放弃了。转到开发人员去排查以及后续人工补偿。\n\n### 几种方案如何选择\n\n- 跟支付、交易打交道，优先 TCC。\n- 大型系统，但要求不那么严格，考虑 消息事务或 SAGA 方案。\n- 单体应用，建议 XA 两阶段提交就可以了。\n- 最大努力通知方案建议都加上，毕竟不可能一出问题就交给开发排查，先重试几次看能不能成功。\n\n## 写在最后\n\n分布式还有很多坑，这篇只是一个小小的总结，从这些坑中，我们也知道分布式有它的优势也有它的劣势，那到底该不该用分布式，完全取决于业务、时间、成本以及开发团队的综合实力。后续我会继续分享分布式中的一些底层原理，当然也少不了分享一些避坑指南。\n\n\n\n参考资料：   \n美团的 Leaf-Snowflake 算法。  \n百度的 UIDGenerator 算法。  \nAdvanced-java\n\n\u003E 你好，我是`悟空哥`，**「7年项目开发经验，全栈工程师，开发组长，超喜欢图解编程底层原理」**。  \n我还`手写了 2 个小程序`，`Java 刷题小程序`，`PMP 刷题小程序`，点击我的公众号菜单打开！  \n另外有 111 本架构师资料以及 1000 道 Java 面试题，都整理成了PDF。  \n可以关注公众号 **「悟空聊架构」** 回复 `悟空` 领取优质资料。\n\n**「转发-\u003E在看-\u003E点赞-\u003E收藏-\u003E评论！！！」** 是对我最大的支持！\n\n**《Java并发必知必会》系列：**  \n\n[1.反制面试官 | 14张原理图 | 再也不怕被问 volatile!](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6861885337568804871)\n\n[2.程序员深夜惨遭老婆鄙视，原因竟是CAS原理太简单？](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6863799243182702599)\n\n[3.用积木讲解ABA原理 | 老婆居然又听懂了！](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6864945088721027079)\n\n[4.全网最细 |  21张图带你领略集合的线程不安全](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6866444584688451591)         \n\n[5.5000字 | 24张图带你彻底理解Java中的21种锁](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6867922895536914446) \n\n[6.干货 | 一口气说出18种队列(Queue)，面试稳了](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6870298844425371655) \n\n\n [🏆 技术专题第五期 | 聊聊分布式的那些事......](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6872367966512644103)\n \n [🏆 技术专题第五期 | 聊聊分布式的那些事......](https:\u002F\u002Fjuejin.im\u002Fpost\u002F6888208307924762638)\n"},author_user_info:{user_id:"3773179639893229",user_name:"悟空聊架构",company:"开发组长 | 全栈",job_title:"公众号：悟空聊架构",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F4\u002F5\u002F1714a695db6cd109?w=963&h=963&f=png&s=24440",level:3,description:"Java，分布式，架构，springcloud",followee_count:28,follower_count:714,post_article_count:50,digg_article_count:268,got_digg_count:974,got_view_count:47031,post_shortmsg_count:6,digg_shortmsg_count:5,isfollowed:a,favorable_author:d,power:1458,study_point:d,university:b,major:b,student_status:d,select_event_count:d,select_online_course_count:d,identity:d},category:{category_id:"6809637769959178254",category_name:"后端",category_url:"backend",rank:h,ctime:1457483880,mtime:1432503193,show_type:3,id:"6809637769959178254",name:"后端",title:"后端",alias:"backend"},tags:[{entriesCount:void 0,subscribed:a,id:"6809641135154135054",tag_id:"6809641135154135054",tag_name:"分布式",color:e,icon:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F1543069161467d7c255d31b971d1898bbaa4fd32f8945.jpg",back_ground:e,show_navi:d,tag_alias:e,post_article_count:1330,concern_user_count:6952,title:"分布式",tagId:"6809641135154135054",articleCount:1330,subscribersCount:6952,createdAt:b,updatedAt:b}],user_interact:{id:6875739447254581000,omitempty:2,user_id:d,is_digg:a,is_follow:a,is_collect:a},title:"这三年被分布式坑惨了，曝光十大坑 | 🏆 技术专题第五期征文",user:{id:"3773179639893229",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:3,user_id:"3773179639893229",user_name:"悟空聊架构",company:"开发组长 | 全栈",job_title:"公众号：悟空聊架构",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F4\u002F5\u002F1714a695db6cd109?w=963&h=963&f=png&s=24440",description:"Java，分布式，架构，springcloud",followee_count:28,follower_count:714,post_article_count:50,digg_article_count:268,got_digg_count:974,got_view_count:47031,post_shortmsg_count:6,digg_shortmsg_count:5,isfollowed:a,favorable_author:d,power:1458,study_point:d,university:b,major:b,student_status:d,select_event_count:d,select_online_course_count:d,identity:d,juejinPower:1458,jobTitle:"公众号：悟空聊架构",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"悟空聊架构",blogAddress:void 0,selfDescription:"Java，分布式，架构，springcloud",beLikedCount:974,beReadCount:47031,followerCount:714,followingCount:28,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:50,pinCount:6,likedArticleCount:268,likedPinCount:5,avatar:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F4\u002F5\u002F1714a695db6cd109?w=963&h=963&f=png&s=24440",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:28,applyEventCount:d},viewCount:void 0,commentsCount:18,isEvent:void 0,abstract:"我们都在讨论分布式，特别是面试的时候，不管是招初级软件工程师还是高级，都会要求懂分布式，甚至要求用过。传得沸沸扬扬的分布式到底是什么东东，有什么优势？ 看过火影的同学肯定知道漩涡鸣人的招牌忍术：多重影分身之术。 这个术有一个特别厉害的地方，过程和心得：多个分身的感受和经历都是相…",latestCommentAt:b,createdAt:new Date(1600883054000),updatedAt:b,isTopicEvent:a,likedCount:69,likeCount:69,content:e,originalUrl:e,type:"post",collected:a,viewsCount:2186,username:"悟空聊架构",viewerHasLiked:a,draftId:"6875738877009592333",collectionCount:d},entryView:{},author:{id:"3773179639893229",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:3,user_id:"3773179639893229",user_name:"悟空聊架构",company:"开发组长 | 全栈",job_title:"公众号：悟空聊架构",avatar_large:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F4\u002F5\u002F1714a695db6cd109?w=963&h=963&f=png&s=24440",description:"Java，分布式，架构，springcloud",followee_count:28,follower_count:714,post_article_count:50,digg_article_count:268,got_digg_count:974,got_view_count:47031,post_shortmsg_count:6,digg_shortmsg_count:5,isfollowed:a,favorable_author:d,power:1458,study_point:d,university:b,major:b,student_status:d,select_event_count:d,select_online_course_count:d,identity:d,juejinPower:1458,jobTitle:"公众号：悟空聊架构",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"悟空聊架构",blogAddress:void 0,selfDescription:"Java，分布式，架构，springcloud",beLikedCount:974,beReadCount:47031,followerCount:714,followingCount:28,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:50,pinCount:6,likedArticleCount:268,likedPinCount:5,avatar:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F4\u002F5\u002F1714a695db6cd109?w=963&h=963&f=png&s=24440",latestLoginedInAt:b,createdAt:b,updatedAt:b,phoneNumber:e,titleDescription:e,followeesCount:28,applyEventCount:d},adEntryList:[],relatedEntryList:[],actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],tagIds:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:o}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:c,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:b},subCommentList:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:b}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:k},pinlist:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:m},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:g,page:h,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:b}},followedList:{pageSize:r,page:d,total:d,pointer:b,lastPointer:b,list:[],loading:a,error:b,canPrev:c,canNext:c,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:d}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:c,category:j,categoryNavList:[]},event:{event:{},loading:a,user:{},actionType:{FETCH:"view\u002Fevent\u002FFETCH",RESET:"view\u002Fevent\u002FRESET"}},academyIndex:{academy:{},bannerList:[],qualitiedList:[],latestList:[],offlineList:[],loading:a,user:{},actionType:{FETCH:"view\u002Facademy\u002FFETCH",RESET:"view\u002Facademy\u002FRESET"}},coursesIndex:{loading:a,list:[],sort:"online",actionType:{FETCH:"view\u002Fcourses\u002FFETCH",RESET:"view\u002Fcourses\u002FRESET",FETCH_MORE:"view\u002Fcourses\u002FFETCH_MORE"}}},component:{indexAside:{bannerList:[],userList:[],actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER"}}},auth:{user:b,clientId:e,token:e},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:d,system:d,total:d}},follow:{subscribedTagList:[]},error:{location:b,errorView:b,statusCode:200},abTest:{info:{}},suspensionPanel:{needSuspension:c},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:b,isOnFocus:a},topic:{visible:a},route:{name:"column",path:p,hash:e,query:{},params:{id:q},fullPath:p,meta:{},from:{name:b,path:s,hash:e,query:{},params:{},fullPath:s,meta:{}}}},serverRendered:c,routePath:p,config:{API_HOST:"apinew.juejin.im",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:833,weibo:845,github:1032,wechatApp:1070}}}}(false,null,true,0,"","0",20,1,"topic","recommended","hot","following","popular","all","newest","\u002Fpost\u002F6875739447254581262","6875739447254581262",100,"\u002F"));</script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/runtime.f3142b8.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/layouts/default.0d655de.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/layouts.default.1c3d5fa.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/17.ec4a0fa.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/.d009df7.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/commons/app.3b100c6.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/vendors~app.204899d.js" defer></script><script src="//s3.pstatp.com/toutiao/xitu_juejin_web/app.88bad42.js" defer></script>
  </body>
</html>
